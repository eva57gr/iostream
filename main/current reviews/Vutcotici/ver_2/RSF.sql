SELECT 
TO_NUMBER(CR.NR_ROW) AS ORDINE,
CR.NUME_ROW AS NR_ROW,



SUM(CASE WHEN  C.FULL_CODE LIKE '%'||CR.CS_CUATM||'%'  THEN L.COL1 ELSE NULL END ) AS COL1,
SUM(CASE WHEN  C.FULL_CODE LIKE '%'||CR.CS_CUATM||'%'  THEN L.COL2 ELSE NULL END ) AS COL2,
SUM(CASE WHEN  C.FULL_CODE LIKE '%'||CR.CS_CUATM||'%'  THEN L.COL3 ELSE NULL END ) AS COL3,
SUM(CASE WHEN  C.FULL_CODE LIKE '%'||CR.CS_CUATM||'%'  THEN L.COL4 ELSE NULL END ) AS COL4,
SUM(CASE WHEN  C.FULL_CODE LIKE '%'||CR.CS_CUATM||'%'  THEN L.COL5 ELSE NULL END ) AS COL5


FROM 

(
-- Start 1 --
SELECT 
 C.CODUL,
 C.FULL_CODE,
 COUNT (DISTINCT CASE WHEN FC.FORM  = :pFORM THEN  FC.CUIIO END)  AS   COL1,
 NULL AS COL2,
 NULL AS COL3,
 NULL AS COL4,
 NULL AS COL5
 FROM 

(
SELECT     

           R.CUIIO,
           R. CUIIO_VERS,
           FC.FORM,
          
           R.CUATM
           
      FROM (
      
  SELECT FC.CUIIO,
                   FC.CUIIO_VERS,
                   FC.FORM,
                   FC.FORM_VERS,
                   FC.STATUT
              FROM CIS2.FORM_CUIIO  FC
                         
              
                   INNER JOIN (  SELECT CUIIO, MAX (CUIIO_VERS) CUIIO_VERS
                                   FROM CIS2.FORM_CUIIO
                                  WHERE FORM IN (:pFORM) AND CUIIO_VERS <= :pPERIOADA_LUNA  
                               GROUP BY CUIIO) BB
                       ON (    BB.CUIIO = FC.CUIIO
                           AND BB.CUIIO_VERS = FC.CUIIO_VERS)
             
             WHERE 
             FC.FORM IN (:pFORM) 
             AND FC.STATUT <> '3'
             --AND FC.FORM_VERS = 2009             
             
             
             ) FC
           INNER JOIN CIS2.RENIM R
               ON (R.CUIIO = FC.CUIIO AND R.CUIIO_VERS = FC.CUIIO_VERS)
               
               ) FC 
          
               
                 INNER JOIN CIS.VW_CL_CUATM C   ON C.CODUL = FC.CUATM
              
               GROUP BY 
              C.CODUL,
              C.FULL_CODE
-- End   1     ----------------------------------------------------
-- Start 2 
              UNION 

SELECT 
       C.CODUL,
       C.FULL_CODE,
 NULL AS COL1,
 COUNT (DISTINCT CASE WHEN D.FORM  = :pFORM THEN  D.CUIIO END)  AS  COL2,
 NULL AS COL3,
  NULL AS COL4,
  NULL AS COL5


         
         
    FROM (SELECT DISTINCT D.CUIIO,
                          D.CUIIO_VERS,
                          D.CUATM,
                          D.FORM
            FROM CIS2.VW_DATA_ALL_FR D
               --  INNER JOIN CIS2.VW_CL_CUATM C ON D.CUATM = C.CODUL
                 
           WHERE D.PERIOADA = :pPERIOADA_LUNA AND D.FORM IN (:pFORM)
             
           ) D
         INNER JOIN CIS2.VW_CL_CUATM C ON C.CODUL = D.CUATM
GROUP BY C.CODUL, C.FULL_CODE

--  End 2

UNION 

-- Start 3 
  SELECT C.CODUL,
         C.FULL_CODE,
         
 
 NULL AS   COL1,
 NULL AS   COL2,
 COUNT (DISTINCT CASE WHEN D.FORM  = :pFORM THEN  D.CUIIO END)  AS  COL3,
  NULL AS COL4,
  NULL AS COL5




         
         
    FROM (
    
    SELECT DISTINCT D.CUIIO,
                          D.CUIIO_VERS,
                          D.CUATM,
                          D.FORM
            FROM USER_EREPORTING.VW_DATA_ALL_FR_PRIMIT D
                 --INNER JOIN CIS2.VW_CL_CUATM C ON D.CUATM = C.CODUL
                 
           WHERE D.PERIOADA  = :pPERIOADA_LUNA   AND D.FORM IN (:pFORM)
             AND D.ID_SCHEMA = 2
             
                 
           ) D
         INNER JOIN CIS2.VW_CL_CUATM C ON C.CODUL = D.CUATM
GROUP BY C.CODUL, C.FULL_CODE

-- End  3 --

UNION 

--Start 4
SELECT
CODUL,
FULL_CODE,
COL1,
COL2,
COL3,
SUM(COL4) AS COL4,
SUM(COL5) AS COL5 

FROM
(
SELECT 
CUATM CODUL,
NULL FULL_CODE,
NULL AS COL1, 
NULL AS COL2,
NULL AS COL3,
SUM(CNT) AS COL4,
NULL AS COL5

FROM
(
SELECT
RIND_ID,
DEN_SHORT,
CUIIO,
CUATM,
---DENUMIRE,
PACHET,
DATA_PRIMIRII,
DATA_PROCESARII,
CAPITOL_DEN,
CAPITOL,
RIND,
COL1,
COL2,
COL3,
COL4,
COL5,
COL6,
COL7,
COL8,
COL9,
COL10,
COL11,
COL12,
COL13,
COL14,
COL15,
COL16,
COL17,
COL18,
COL19,
COL20,
COL21,
COL22,
CASE WHEN  COL1 > 0 AND  COL1 IS NOT NULL THEN 1 ELSE 0  END 
+ CASE WHEN  COL2 > 0 AND  COL2 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL3 > 0 AND  COL3 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL4 > 0 AND  COL4 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL5 > 0 AND  COL5 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL6 > 0 AND  COL6 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL7 > 0 AND  COL7 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL8 > 0 AND  COL8 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL9 > 0 AND  COL9 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL10 > 0 AND  COL10 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL11 > 0 AND  COL11 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL12 > 0 AND  COL1 IS NOT NULL THEN 1 ELSE 0  END 
+ CASE WHEN  COL13 > 0 AND  COL2 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL14 > 0 AND  COL3 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL15 > 0 AND  COL4 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL16 > 0 AND  COL5 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL17 > 0 AND  COL6 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL18 > 0 AND  COL7 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL19 > 0 AND  COL8 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL20 > 0 AND  COL9 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL21 > 0 AND  COL10 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL22 > 0 AND  COL11 IS NOT NULL THEN 1 ELSE 0  END


 CNT
FROM

(
SELECT
ROWNUM RIND_ID,
DEN_SHORT,
CUIIO,
CUATM,
--DENUMIRE,
PACHET,
DATA_PRIMIRII,
DATA_PROCESARII,
CAPITOL_DEN,
CAPITOL,
RIND,
COL1,
COL2,
COL3,
COL4,
COL5,
COL6,
COL7,
COL8,
COL9,
COL10,
COL11,
COL12,
COL13,
COL14,
COL15,
COL16,
COL17,
COL18,
COL19,
COL20,
COL21,
COL22
 
 
FROM
(


SELECT
DISTINCT
NULL DEN_SHORT,
D.CUIIO,
D.CUATM,
--R.DENUMIRE,
MAX(D.PACHET) AS PACHET,
 NULL  AS DATA_PRIMIRII,
NULL  AS DATA_PROCESARII,
D.CAPITOL_DEN,
D.CAPITOL,
D.RIND,
SUM(D.COL1) AS COL1,
SUM(D.COL2) AS COL2,
SUM(D.COL3) AS COL3,
SUM(D.COL4) AS COL4,
SUM(D.COL5) AS COL5,
SUM(D.COL6) AS COL6,
SUM(D.COL7) AS COL7,
SUM(D.COL8) AS COL8,
SUM(D.COL9) AS COL9,
SUM(D.COL10) AS COL10,
SUM(D.COL11) AS COL11,


SUM(D.COL12) AS COL12,
SUM(D.COL13) AS COL13,
SUM(D.COL14) AS COL14,
SUM(D.COL15) AS COL15,
SUM(D.COL16) AS COL16,
SUM(D.COL17) AS COL17,
SUM(D.COL18) AS COL18,
SUM(D.COL19) AS COL19,
SUM(D.COL20) AS COL20,
SUM(D.COL21) AS COL21,
SUM(D.COL22) AS COL22

FROM
CIS2.VW_DATA_ALL_FR D --M1, CONS.TS, 5CI,65 AUTO, 2 INVEST
--INNER JOIN CIS2.RENIM R ON R.CUIIO = D.CUIIO AND R.CUIIO_VERS = D.CUIIO_VERS
--INNER JOIN CIS2.MD_FORM F ON (D.FORM=F.FORM AND D.FORM_VERS=F.FORM_VERS)
INNER JOIN USER_EREPORTING.VW_DATA_ALL_FR_PRIMIT PR ON PR.CUIIO = D.CUIIO AND PR.CUIIO_VERS = D.CUIIO_VERS AND D.PERIOADA=PR.PERIOADA AND D.FORM=PR.FORM AND PR.ID_SCHEMA IN (2)
--INNER JOIN CIS2.CONTROL C ON (D.PERIOADA=C.PERIOADA AND D.CUIIO=C.CUIIO AND D.CUIIO_VERS=C.CUIIO_VERS)
WHERE
D.PERIOADA = :pPERIOADA_LUNA AND
--D.CUATM LIKE '01%' AND
D.FORM IN (:pFORM)


AND D.CAPITOL NOT  IN (1119,1091,1109,1135) 
--AND D.CUIIO IN  (400001,400053,458868 )
GROUP BY
--F.DEN_SHORT,
D.CUIIO,
D.CUATM,
--R.DENUMIRE,
D.CAPITOL_DEN,
D.CAPITOL,
D.RIND

ORDER BY
DEN_SHORT,
CUIIO,
CAPITOL,
RIND

)

)



)

GROUP BY 
CUATM





union 


SELECT 
CUATM CODUL,
NULL FULL_CODE,
NULL AS COL1, 
NULL AS COL2,
NULL AS COL3,
NULL AS COL4,
SUM(CNT) AS COL5

FROM
(
SELECT
RIND_ID,
DEN_SHORT,
CUIIO,
CUATM,
--DENUMIRE,
PACHET,
DATA_PRIMIRII,
DATA_PROCESARII,
CAPITOL_DEN,
CAPITOL,
RIND,
COL1,
COL2,
COL3,
COL4,
COL5,
COL6,
COL7,
COL8,
COL9,
COL10,
COL11,
COL12,
COL13,
COL14,
COL15,
COL16,
COL17,
COL18,
COL19,
COL20,
COL21,
COL22,
CASE WHEN  COL1 > 0 AND  COL1 IS NOT NULL THEN 1 ELSE 0  END 
+ CASE WHEN  COL2 > 0 AND  COL2 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL3 > 0 AND  COL3 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL4 > 0 AND  COL4 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL5 > 0 AND  COL5 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL6 > 0 AND  COL6 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL7 > 0 AND  COL7 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL8 > 0 AND  COL8 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL9 > 0 AND  COL9 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL10 > 0 AND  COL10 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL11 > 0 AND  COL11 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL12 > 0 AND  COL1 IS NOT NULL THEN 1 ELSE 0  END 
+ CASE WHEN  COL13 > 0 AND  COL2 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL14 > 0 AND  COL3 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL15 > 0 AND  COL4 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL16 > 0 AND  COL5 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL17 > 0 AND  COL6 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL18 > 0 AND  COL7 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL19 > 0 AND  COL8 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL20 > 0 AND  COL9 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL21 > 0 AND  COL10 IS NOT NULL THEN 1 ELSE 0  END
+ CASE WHEN  COL22 > 0 AND  COL11 IS NOT NULL THEN 1 ELSE 0  END


 CNT
FROM

(
SELECT
ROWNUM RIND_ID,
DEN_SHORT,
CUIIO,
CUATM,
--DENUMIRE,
PACHET,
DATA_PRIMIRII,
DATA_PROCESARII,
CAPITOL_DEN,
CAPITOL,
RIND,
COL1,
COL2,
COL3,
COL4,
COL5,
COL6,
COL7,
COL8,
COL9,
COL10,
COL11,
COL12,
COL13,
COL14,
COL15,
COL16,
COL17,
COL18,
COL19,
COL20,
COL21,
COL22
 
 
FROM
(


SELECT
DISTINCT
NULL DEN_SHORT,
D.CUIIO,
D.CUATM,
--R.DENUMIRE,
MAX(D.PACHET) AS PACHET,
NULL AS DATA_PRIMIRII,
NULL  AS DATA_PROCESARII,
D.CAPITOL_DEN,
D.CAPITOL,
D.RIND,
SUM(D.COL1) AS COL1,
SUM(D.COL2) AS COL2,
SUM(D.COL3) AS COL3,
SUM(D.COL4) AS COL4,
SUM(D.COL5) AS COL5,
SUM(D.COL6) AS COL6,
SUM(D.COL7) AS COL7,
SUM(D.COL8) AS COL8,
SUM(D.COL9) AS COL9,
SUM(D.COL10) AS COL10,
SUM(D.COL11) AS COL11,


SUM(D.COL12) AS COL12,
SUM(D.COL13) AS COL13,
SUM(D.COL14) AS COL14,
SUM(D.COL15) AS COL15,
SUM(D.COL16) AS COL16,
SUM(D.COL17) AS COL17,
SUM(D.COL18) AS COL18,
SUM(D.COL19) AS COL19,
SUM(D.COL20) AS COL20,
SUM(D.COL21) AS COL21,
SUM(D.COL22) AS COL22 ---------------------------------------------------------

FROM
CIS2.VW_DATA_ALL_FR D --M1, CONS.TS, 5CI,65 AUTO, 2 INVEST
--INNER JOIN CIS2.RENIM R ON R.CUIIO = D.CUIIO AND R.CUIIO_VERS = D.CUIIO_VERS
--INNER JOIN CIS2.MD_FORM F ON (D.FORM=F.FORM AND D.FORM_VERS=F.FORM_VERS)
--INNER JOIN USER_EREPORTING.VW_DATA_ALL_PRIMIT PR ON PR.CUIIO = D.CUIIO AND PR.CUIIO_VERS = D.CUIIO_VERS AND D.PERIOADA=PR.PERIOADA AND D.FORM=PR.FORM AND PR.ID_SCHEMA IN (2)
--INNER JOIN CIS2.CONTROL C ON (D.PERIOADA=C.PERIOADA AND D.CUIIO=C.CUIIO AND D.CUIIO_VERS=C.CUIIO_VERS)
WHERE
D.PERIOADA = :pPERIOADA_LUNA AND
--D.CUATM LIKE '01%' AND
D.FORM IN (:pFORM)
AND D.CAPITOL NOT  IN (1119,1091,1109,1135) 

AND D.CUIIO not IN  (38868451 )
GROUP BY
--F.DEN_SHORT,
D.CUIIO,
D.CUATM,
--R.DENUMIRE,
D.CAPITOL_DEN,
D.CAPITOL,
D.RIND

ORDER BY
DEN_SHORT,
CUIIO,
CAPITOL,
RIND

)

)
)

GROUP BY 
CUATM

)


group by 

CODUL,
FULL_CODE,
COL1,
COL2,
COL3

order by 
codul


--End 4


              ) L
     
     INNER JOIN CIS.VW_CL_CUATM C   ON C.CODUL = L.CODUL
     CROSS JOIN (
     
    
SELECT
      DECODE(CS.CODUL, 
      '0000000','01','0100000','02','1111111','03','0300000','04',
      '1400000','05','3400000','06','3600000','07','4100000','08','4300000','09',
      '4500000','10','4800000','11','6200000','12','7100000','13','7400000','14',
      '7800000','15','2222222','16','1000000','17','2500000','18','3100000','19',
      '3800000','20','5300000','21','5500000','22','6000000','23','6400000','24',
      '6700000','25','8000000','26','8300000','27','8900000','28','9200000','29',
      '3333333','30','1200000','31','1700000','32','2100000','33','2700000','34',
      '2900000','35','5700000','36','8500000','37','8700000','38','9600000','39',
          
               '9601000', '40',
               '9602000', '41',
               '9603000', '42'
      
      )
      AS NR_ROW,
      CS.DENUMIRE AS NUME_ROW,
      CS.CODUL AS CS_CUATM
    FROM
      VW_CL_CUATM CS
    WHERE
      CS.CODUL 
      IN(
         '0000000','0100000','1111111','0300000','1400000','3400000','3600000','4100000','4300000','4500000',
         '4800000','6200000','7100000','7400000','7800000','2222222','1000000','2500000','3100000','3800000',
         '5300000','5500000','6000000','6400000','6700000','8000000','8300000','8900000','9200000','3333333',
         '1200000','1700000','2100000','2700000','2900000','5700000','8500000','8700000','9600000',
              
               '9601000', 
               '9602000', 
               '9603000' 
         
        )
      
     ) CR 
     
     WHERE 
     1=1
    
     group by 
    CR.NUME_ROW, 
    TO_NUMBER(CR.NR_ROW),
    CR.CS_CUATM 
      
      ORDER BY
      CR.NR_ROW