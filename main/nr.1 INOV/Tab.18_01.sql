SELECT *
FROM

(
SELECT DISTINCT
      D.CUIIO,
      D.CAEM2,
      BS.PERS_IT,
      COUNT(DISTINCT CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2', '1042.3.1.1','1042.3.1.2','1042.3.1.3','1046.7.1.1','1046.7.1.2','1046.7.1.3','1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL1,
      COUNT(DISTINCT CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1046.7.1.1','1046.7.1.2','1046.7.1.3','1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL2_1,
      COUNT(DISTINCT CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2','1042.3.1.1','1042.3.1.2','1042.3.1.3') AND D.COL1=1 THEN 1 END) AS COL2_2,
      COUNT(DISTINCT CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2','1042.3.1.1','1042.3.1.2','1042.3.1.3') AND D.COL1=1 THEN 1 END) AS COL3_1,
      COUNT(DISTINCT CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1046.7.1.1','1046.7.1.2','1046.7.1.3','1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL3_2,
      COUNT(DISTINCT CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2','1042.3.1.1','1042.3.1.2','1042.3.1.3') AND D.COL1=1 THEN 1 END) AS COL4_1,
      COUNT(DISTINCT CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1046.7.1.1','1046.7.1.2','1046.7.1.3','1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL4_2
    FROM
      CIS2.VW_DATA_ALL D  
      INNER JOIN
      CIS2.X_BAZA_SONDAJ BS ON D.CUIIO=BS.CUIIO AND D.ANUL=BS.ANUL
    WHERE
      D.PERIOADA IN (:pPERIOADA) AND 
      D.FORM_VERS = :pFORM_VERS     AND   
      D.FORM= :pFORM     AND    
      (:pID_MDTABLE=:pID_MDTABLE) AND
      D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%'  AND 
      D.FORM IN (48)
    GROUP BY
      D.CUIIO,
      D.CAEM2,
      BS.PERS_IT
      
      )