--INSERT INTO TABLE_OUT 
--(
--  PERIOADA,
--  FORM,
--  FORM_VERS,
--  ID_MDTABLE,
--  COD_CUATM,
--  NR_SECTIE,
--  NUME_SECTIE,
--  NR_SECTIE1,
--  NUME_SECTIE1,
--  NR_SECTIE2,
--  NUME_SECTIE2,
--  NR_ROW,
--  ORDINE,
--  DECIMAL_POS,
--  NUME_ROW,  
--COL1,COL2,COL3,COL4,COL5,COL6,COL7,COL8,COL9,COL10,
--  COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,
--  COL21,COL22,COL23,COL24,COL25,COL26,COL27,COL28,COL29,COL30,
--  COL31,COL32,COL33,COL34,COL35,COL36,COL37,COL38,COL39,COL40,
--  COL41,COL42,COL43,COL44,COL45,COL46,COL47,COL48,COL49,COL50
----  COL51,COL52,COL53,COL54,COL55,COL56,COL57,COL58,COL59,COL60
--)
--

SELECT
   :pPERIOADA AS PERIOADA,
  :pFORM AS FORM,
  :pFORM_VERS AS FORM_VERS,
  :pID_MDTABLE AS ID_MDTABLE,
  :pCOD_CUATM AS COD_CUATM,
         
  '0' AS NR_SECTIE,
  '0' AS NUME_SECTIE,
  '0' AS NR_SECTIE1,
  '0' AS NUME_SECTIE1,
  '0' AS NR_SECTIE2,
  '0' AS NUME_SECTIE2,
    ROWNUM AS NR_ROW,
  ROWNUM AS ORDINE,
  '00000000000000000000000000000000000000000000000000' AS DECIMAL_POS,
  NUME_ROW,
  
    
  COL1,COL2,COL3,COL4,COL5,COL6,COL7,COL8,COL9,COL10,
  COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,
  COL21,COL22,COL23,COL24,COL25,COL26,COL27,COL28,COL29,COL30,
  COL31,COL32,COL33,COL34,COL35,COL36,COL37,COL38,COL39,COL40,
  COL41,COL42,COL43,COL44,COL45,COL46,COL47,COL48,COL49,COL50

FROM
(
SELECT
  CC.CODUL AS NUME_ROW,
  SUM(L.COL1) AS COL1,
  SUM(L.COL2) AS COL2,
  SUM(L.COL3) AS COL3,
  SUM(L.COL4) AS COL4,
  SUM(L.COL5) AS COL5,
  SUM(L.COL6) AS COL6,
  SUM(L.COL7) AS COL7,
  SUM(L.COL8) AS COL8,
  SUM(L.COL9) AS COL9,
  SUM(L.COL10) AS COL10,
  SUM(L.COL11) AS COL11,
  SUM(L.COL12) AS COL12,
  SUM(L.COL13) AS COL13,
  SUM(L.COL14) AS COL14,
  SUM(L.COL15) AS COL15,
  SUM(L.COL16) AS COL16,
  SUM(L.COL17) AS COL17,
  SUM(L.COL18) AS COL18,
  SUM(L.COL19) AS COL19,
  SUM(L.COL20) AS COL20,
  SUM(L.COL21) AS COL21,
  SUM(L.COL22) AS COL22,
  SUM(L.COL23) AS COL23,
  SUM(L.COL24) AS COL24,
  SUM(L.COL25) AS COL25,
  SUM(L.COL26) AS COL26,
  SUM(L.COL27) AS COL27,
  SUM(L.COL28) AS COL28,
  SUM(L.COL29) AS COL29,
  SUM(L.COL30) AS COL30,
  SUM(L.COL31) AS COL31,
  SUM(L.COL32) AS COL32,
  SUM(L.COL33) AS COL33,
  SUM(L.COL34) AS COL34,
  SUM(L.COL35) AS COL35,
  SUM(L.COL36) AS COL36,
  SUM(L.COL37) AS COL37,
  SUM(L.COL38) AS COL38,
  SUM(L.COL39) AS COL39,
  SUM(L.COL40) AS COL40,
  SUM(L.COL41) AS COL41,
  SUM(L.COL42) AS COL42,
  SUM(L.COL43) AS COL43,
  SUM(L.COL44) AS COL44,
  SUM(L.COL45) AS COL45,
  SUM(L.COL46) AS COL46,
  SUM(L.COL47) AS COL47,
  SUM(L.COL48) AS COL48,
  SUM(L.COL49) AS COL49,
  SUM(L.COL50) AS COL50

FROM

(
SELECT 
CODUL,
FULL_CODE,
SUM(COL1) AS COL1,
SUM(COL2) AS COL2,
SUM(COL3) AS COL3,
SUM(COL4) AS COL4,
SUM(COL5) AS COL5,
SUM(COL6) AS COL6,
SUM(COL7) AS COL7,
SUM(COL8) AS COL8,
SUM(COL9) AS COL9,
SUM(COL10) AS COL10,

SUM(COL11) AS COL11,
SUM(COL12) AS COL12,
SUM(COL13) AS COL13,
SUM(COL14) AS COL14,
SUM(COL15) AS COL15,
SUM(COL16) AS COL16,
SUM(COL17) AS COL17,
SUM(COL18) AS COL18,
SUM(COL19) AS COL19,
SUM(COL20) AS COL20,

SUM(COL21) AS COL21,
SUM(COL22) AS COL22,
SUM(COL23) AS COL23,
SUM(COL24) AS COL24,
SUM(COL25) AS COL25,
SUM(COL26) AS COL26,
SUM(COL27) AS COL27,
SUM(COL28) AS COL28,
SUM(COL29) AS COL29,
SUM(COL30) AS COL30,


SUM(COL31) AS COL31,
SUM(COL32) AS COL32,
SUM(COL33) AS COL33,
SUM(COL34) AS COL34,
SUM(COL35) AS COL35,
SUM(COL36) AS COL36,
SUM(COL37) AS COL37,
SUM(COL38) AS COL38,
SUM(COL39) AS COL39,
SUM(COL40) AS COL40,

SUM(COL41) AS COL41,
SUM(COL42) AS COL42,
SUM(COL43) AS COL43,
SUM(COL44) AS COL44,
SUM(COL45) AS COL45,
SUM(COL46) AS COL46,
SUM(COL47) AS COL47,
SUM(COL48) AS COL48,
SUM(COL49) AS COL49,
SUM(COL50) AS COL50

FROM 
(
SELECT    
--           
          -- SUBSTR(C.CODUL,1,3) CODUL,

           C.CODUL,
            C.FULL_CODE,
           COUNT(DISTINCT CASE WHEN C.CODUL = R.CAEM2 AND CC.FULL_CODE LIKE '%'||'1111111'||';%' THEN FC.CUIIO END ) AS COL1,
           NULL AS COL2,
           NULL AS COL3,
           NULL AS COL4,
           NULL AS COL5,
           NULL AS COL6,
           NULL AS COL7,
           NULL AS COL8,
           NULL AS COL9,
           NULL AS COL10,
           
                COUNT(DISTINCT CASE WHEN C.CODUL = R.CAEM2 AND CC.FULL_CODE LIKE '%'||'2222222'||';%' THEN FC.CUIIO END ) AS COL11,
           NULL AS COL12,
           NULL AS COL13,
           NULL AS COL14,
           NULL AS COL15,
           NULL AS COL16,
           NULL AS COL17,
           NULL AS COL18,
           NULL AS COL19,
           NULL AS COL20,
           
           
           COUNT(DISTINCT CASE WHEN C.CODUL = R.CAEM2 AND CC.FULL_CODE LIKE '%'||'3333333'||';%' THEN FC.CUIIO END ) AS COL21,
           NULL AS COL22,
           NULL AS COL23,
           NULL AS COL24,
           NULL AS COL25,
           NULL AS COL26,
           NULL AS COL27,
           NULL AS COL28,
           NULL AS COL29,
           NULL AS COL30,
           
            COUNT(DISTINCT CASE WHEN C.CODUL = R.CAEM2 AND CC.FULL_CODE LIKE '%'||'0100000'||';%' THEN FC.CUIIO END ) AS COL31,
           NULL AS COL32,
           NULL AS COL33,
           NULL AS COL34,
           NULL AS COL35,
           NULL AS COL36,
           NULL AS COL37,
           NULL AS COL38,
           NULL AS COL39,
           NULL AS COL40,
           
           
            COUNT(DISTINCT CASE WHEN C.CODUL = R.CAEM2 AND CC.FULL_CODE LIKE '%'||'9600000'||';%' THEN FC.CUIIO END ) AS COL41,
           NULL AS COL42,
           NULL AS COL43,
           NULL AS COL44,
           NULL AS COL45,
           NULL AS COL46,
           NULL AS COL47,
           NULL AS COL48,
           NULL AS COL49,
           NULL AS COL50
           

           
           
          
           
           
      FROM (SELECT FC.CUIIO,
                   FC.CUIIO_VERS,
                   FC.FORM,
                   FC.FORM_VERS,
                   FC.STATUT
              FROM CIS2.FORM_CUIIO  FC
                   INNER JOIN (  SELECT CUIIO, MAX (CUIIO_VERS) CUIIO_VERS
                                   FROM CIS2.FORM_CUIIO
                                  WHERE FORM IN (:pFORM) AND CUIIO_VERS <= :pPERIOADA
                               GROUP BY CUIIO) BB
                       ON (    BB.CUIIO = FC.CUIIO
                           AND BB.CUIIO_VERS = FC.CUIIO_VERS)
             WHERE FC.FORM IN (:pFORM) AND FC.STATUT <> '3') FC
           INNER JOIN CIS2.RENIM R
               ON (R.CUIIO = FC.CUIIO AND R.CUIIO_VERS = FC.CUIIO_VERS)
               INNER JOIN CIS2.VW_CL_CUATM CC ON CC.CODUL = R.CUATM
               
           
               
                    CROSS JOIN (
                    SELECT C.*
FROM CIS2.VW_CL_CAEM2 C

                    ) C 
                    
                           

GROUP BY 
C.CODUL,
C.FULL_CODE,
C.DENUMIRE


UNION ALL 
SELECT 
  C.CODUL,
  C.FULL_CODE,

--  NULL AS COL1,
-- COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2', '1042.3.1.1','1042.3.1.2','1042.3.1.3','1046.7.1.1','1046.7.1.2','1046.7.1.3','1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL2,
-- COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2') AND D.COL1=1 THEN 1 END) AS COL3,
-- COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1042.3.1.1','1042.3.1.2','1042.3.1.3') AND D.COL1=1 THEN 1 END) AS COL4,
-- COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1046.7.1.1','1046.7.1.2','1046.7.1.3') AND D.COL1=1 THEN 1 END) AS COL5,
-- COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL6,
-- COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.3.1') AND D.COL1=1 THEN 1 END) AS COL7,
-- COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.3.2') AND D.COL1=1 THEN 1 END) AS COL8,
-- COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1045.5.2.1') AND D.COL1=1 THEN 1 END) AS COL9,
-- COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1045.5.2.2') AND D.COL1=1 THEN 1 END) AS COL10,
-- 
 
 NULL AS COL1,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'1111111'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2', '1042.3.1.1','1042.3.1.2','1042.3.1.3','1046.7.1.1','1046.7.1.2','1046.7.1.3','1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL2,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'1111111'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2') AND D.COL1=1 THEN 1 END) AS COL3,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'1111111'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1042.3.1.1','1042.3.1.2','1042.3.1.3') AND D.COL1=1 THEN 1 END) AS COL4,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'1111111'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1046.7.1.1','1046.7.1.2','1046.7.1.3') AND D.COL1=1 THEN 1 END) AS COL5,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'1111111'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL6,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'1111111'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.3.1') AND D.COL1=1 THEN 1 END) AS COL7,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'1111111'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.3.2') AND D.COL1=1 THEN 1 END) AS COL8,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'1111111'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1045.5.2.1') AND D.COL1=1 THEN 1 END) AS COL9,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'1111111'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1045.5.2.2') AND D.COL1=1 THEN 1 END) AS COL10,
 
 
  NULL AS COL11,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'2222222'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2', '1042.3.1.1','1042.3.1.2','1042.3.1.3','1046.7.1.1','1046.7.1.2','1046.7.1.3','1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL12,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'2222222'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2') AND D.COL1=1 THEN 1 END) AS COL13,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'2222222'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1042.3.1.1','1042.3.1.2','1042.3.1.3') AND D.COL1=1 THEN 1 END) AS COL14,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'2222222'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1046.7.1.1','1046.7.1.2','1046.7.1.3') AND D.COL1=1 THEN 1 END) AS COL15,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'2222222'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL16,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'2222222'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.3.1') AND D.COL1=1 THEN 1 END) AS COL17,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'2222222'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.3.2') AND D.COL1=1 THEN 1 END) AS COL18,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'2222222'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1045.5.2.1') AND D.COL1=1 THEN 1 END) AS COL19,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'2222222'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1045.5.2.2') AND D.COL1=1 THEN 1 END) AS COL20,
 
 
 NULL AS COL21,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'3333333'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2', '1042.3.1.1','1042.3.1.2','1042.3.1.3','1046.7.1.1','1046.7.1.2','1046.7.1.3','1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL22,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'3333333'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2') AND D.COL1=1 THEN 1 END) AS COL23,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'3333333'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1042.3.1.1','1042.3.1.2','1042.3.1.3') AND D.COL1=1 THEN 1 END) AS COL24,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'3333333'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1046.7.1.1','1046.7.1.2','1046.7.1.3') AND D.COL1=1 THEN 1 END) AS COL25,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'3333333'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL26,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'3333333'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.3.1') AND D.COL1=1 THEN 1 END) AS COL27,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'3333333'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.3.2') AND D.COL1=1 THEN 1 END) AS COL28,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'3333333'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1045.5.2.1') AND D.COL1=1 THEN 1 END) AS COL29,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'3333333'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1045.5.2.2') AND D.COL1=1 THEN 1 END) AS COL30,
 
 
 NULL AS COL31,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0100000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2', '1042.3.1.1','1042.3.1.2','1042.3.1.3','1046.7.1.1','1046.7.1.2','1046.7.1.3','1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL32,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0100000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2') AND D.COL1=1 THEN 1 END) AS COL33,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0100000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1042.3.1.1','1042.3.1.2','1042.3.1.3') AND D.COL1=1 THEN 1 END) AS COL34,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0100000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1046.7.1.1','1046.7.1.2','1046.7.1.3') AND D.COL1=1 THEN 1 END) AS COL35,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0100000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL36,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0100000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.3.1') AND D.COL1=1 THEN 1 END) AS COL37,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0100000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.3.2') AND D.COL1=1 THEN 1 END) AS COL38,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0100000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1045.5.2.1') AND D.COL1=1 THEN 1 END) AS COL39,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0100000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1045.5.2.2') AND D.COL1=1 THEN 1 END) AS COL40,
 
 
  NULL AS COL51,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'9600000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2', '1042.3.1.1','1042.3.1.2','1042.3.1.3','1046.7.1.1','1046.7.1.2','1046.7.1.3','1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL52,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'9600000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2') AND D.COL1=1 THEN 1 END) AS COL53,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'9600000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1042.3.1.1','1042.3.1.2','1042.3.1.3') AND D.COL1=1 THEN 1 END) AS COL54,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'9600000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1046.7.1.1','1046.7.1.2','1046.7.1.3') AND D.COL1=1 THEN 1 END) AS COL55,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'9600000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL56,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'9600000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.3.1') AND D.COL1=1 THEN 1 END) AS COL57,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'9600000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.3.2') AND D.COL1=1 THEN 1 END) AS COL58,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'9600000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1045.5.2.1') AND D.COL1=1 THEN 1 END) AS COL59,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'9600000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1045.5.2.2') AND D.COL1=1 THEN 1 END) AS COL60
 
 
 
 
FROM
  CIS2.VW_DATA_ALL D


CROSS JOIN (
                    SELECT C.*
FROM CIS2.VW_CL_CAEM2 C

                    ) C 
WHERE
  D.PERIOADA IN (:pPERIOADA) AND 
  D.FORM_VERS = :pFORM_VERS     AND   
  D.FORM= :pFORM     AND    
 -- D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND 
  D.FORM IN (48)
GROUP BY
  C.CODUL,
  C.FULL_CODE

)  

            
GROUP BY 
CODUL,
FULL_CODE


    

  ORDER BY
  CODUL
) L

         INNER JOIN CIS2.VW_CL_CAEM2 C ON C.CODUL = L.CODUL
          INNER JOIN CIS2.VW_CL_CAEM2 CC ON C.FULL_CODE LIKE '%'||CC.CODUL||';%'


 --AND   CC.CODUL LIKE '%00'

GROUP BY 
CC.CODUL,
CC.FULL_CODE
ORDER BY
CC.FULL_CODE
)
