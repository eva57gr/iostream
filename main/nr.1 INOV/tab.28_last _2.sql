SELECT 
  CC.CODUL AS NUME_ROW,
  CC.FULL_CODE,
  SUM(L.COL1) AS COL1,
  SUM(L.COL2) AS COL2,
  SUM(L.COL3) AS COL3,
  SUM(L.COL4) AS COL4,
  SUM(L.COL5) AS COL5,
  SUM(L.COL6) AS COL6,
  SUM(L.COL7) AS COL7,
  SUM(L.COL8) AS COL8,
  SUM(L.COL9) AS COL9,
  SUM(L.COL10) AS COL10
  FROM
(
SELECT 
  C.CODUL,
  C.FULL_CODE,

  NULL AS COL1,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2', '1042.3.1.1','1042.3.1.2','1042.3.1.3','1046.7.1.1','1046.7.1.2','1046.7.1.3','1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL2,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2') AND D.COL1=1 THEN 1 END) AS COL3,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1042.3.1.1','1042.3.1.2','1042.3.1.3') AND D.COL1=1 THEN 1 END) AS COL4,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1046.7.1.1','1046.7.1.2','1046.7.1.3') AND D.COL1=1 THEN 1 END) AS COL5,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN 1 END) AS COL6,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.3.1') AND D.COL1=1 THEN 1 END) AS COL7,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1041.2.3.2') AND D.COL1=1 THEN 1 END) AS COL8,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1045.5.2.1') AND D.COL1=1 THEN 1 END) AS COL9,
 COUNT(DISTINCT CASE WHEN  C.CODUL = D.CAEM2 AND D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND  D.CAPITOL||'.'||D.RIND IN ('1045.5.2.2') AND D.COL1=1 THEN 1 END) AS COL10

 
 
 
FROM
  CIS2.VW_DATA_ALL D


CROSS JOIN (
                    SELECT C.*
FROM CIS2.VW_CL_CAEM2 C

                    ) C 
WHERE
  D.PERIOADA IN (:pPERIOADA) AND 
  D.FORM_VERS = :pFORM_VERS     AND   
  D.FORM= :pFORM     AND    
 -- D.CUATM_FULL LIKE '%'||'0000000'||';%'  AND 
  D.FORM IN (48)
GROUP BY
  C.CODUL,
  C.FULL_CODE )  L
  
     INNER JOIN CIS2.VW_CL_CAEM2 C ON C.CODUL = L.CODUL
          INNER JOIN CIS2.VW_CL_CAEM2 CC ON C.FULL_CODE LIKE '%'||CC.CODUL||';%'
          
          
          GROUP BY
          CC.CODUL,
          CC.FULL_CODE
          
          ORDER BY 
          CC.FULL_CODE
          