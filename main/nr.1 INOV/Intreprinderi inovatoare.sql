
SELECT
--  :pPERIOADA AS PERIOADA,
--  :pFORM AS FORM,
--  :pFORM_VERS AS FORM_VERS,
--  :pID_MDTABLE AS ID_MDTABLE,
--  :pCOD_CUATM AS COD_CUATM,
--         
--  '0' AS NR_SECTIE,
--  '0' AS NUME_SECTIE,
--  '0' AS NR_SECTIE1,
--  '0' AS NUME_SECTIE1,
--  '0' as NR_SECTIE2,
--  '0' as NUME_SECTIE2,
  NR_SECTIE AS NR_ROW,
  '0'AS ORDINE,
  '0000000000000000000000000000000000000000' AS DECIMAL_POS,
  NUME_SECTIE AS NUME_ROW,
  SUM(COL1) AS COL1,
  SUM(COL2) AS COL2, 
  ROUND(SUM(COL2)/CIS2.NOZERO(SUM(COL1))*100,1) AS COL3  
  
--  SUM(COL4) AS COL4, SUM(COL5) AS COL5, 
--  ROUND((SUM(COL4) + SUM(COL5))/CIS2.NOZERO (SUM(COL1))*100,1) AS COL6,
--  ROUND((SUM(COL4) + SUM(COL5))/CIS2.NOZERO (SUM(COL2))*100,1) AS COL7,
--  NULL AS COL8, NULL AS COL9,
--  SUM(COL10) AS COL10, 
--  SUM(COL11) AS COL11, 
--  SUM(COL12) AS COL12, 
--  SUM(COL13) AS COL13,  
--  SUM(COL14) AS COL14, 
--  SUM(COL15) AS COL15,
--  SUM(COL16) AS COL16,
--  SUM(COL17) AS COL17,
----  
--  ROUND(((SUM(COL15)/CIS2.NOZERO(SUM(COL14)))*100),1) AS COL18,  
--  ROUND(((SUM(COL16)/CIS2.NOZERO(SUM(COL14)))*100),1) AS COL19,  
--  ROUND(((SUM(COL16)/CIS2.NOZERO(SUM(COL15)))*100),1) AS COL20,  
--  ROUND(((SUM(COL17)/CIS2.NOZERO(SUM(COL14)))*100),1) AS COL21,  
--  ROUND(((SUM(COL17)/CIS2.NOZERO(SUM(COL15)))*100),1) AS COL22,
--
----
--  ROUND(SUM(COL23),1) AS COL23,
--  ROUND(SUM(COL24),1) AS COL24,
--  ROUND(SUM(COL25),1) AS COL25,
--  ROUND(SUM(COL26),1) AS COL26,
--  ROUND(SUM(COL27),1) AS COL27,
--  ROUND(SUM(COL28),1) AS COL28,
--  
--  
--  ROUND(((SUM(COL23)/CIS2.NOZERO(SUM(COL15)))*100),1) AS COL29,
--  ROUND(((SUM(COL23)/CIS2.NOZERO(SUM(COL14)))*100),1) AS COL30,
--  
--  SUM(COL31)  AS COL31,
--  
--  ROUND(((SUM(COL2)/CIS2.NOZERO(SUM(COL31)))*100),1) AS COL32,   
--
--  SUM(COL33) AS COL33,
--  SUM(COL34) AS COL34,
--  NULL AS COL35, NULL AS COL36,
--  SUM( COL37) AS COL37,
--  NULL AS COL38,
--  SUM( COL39) AS COL39
  

   
FROM
(
SELECT
  CTM.NR_ROW    AS NR_SECTIE,
  CTM.NUME_ROW AS NUME_SECTIE,
  D.CUIIO,
  CIS2.NVAL(COUNT( DISTINCT CASE WHEN D.CAPITOL||'.'||D.RIND IN ('100.00','100.01','100.02','100.03','100.04','100.05','100.06','100.07')THEN D.CUIIO END )) AS COL1,
   
 CIS2.NVAL(MAX(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2', '1042.3.1.1','1042.3.1.2','1042.3.1.3','1046.7.1.1','1046.7.1.2','1046.7.1.3','1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 
  THEN D.COL1 ELSE NULL END)) AS COL2,

(CIS2.NVAL(MAX(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2', '1042.3.1.1','1042.3.1.2','1042.3.1.3','1046.7.1.1','1046.7.1.2','1046.7.1.3','1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') 
  AND D.COL1=1  THEN D.COL1 ELSE NULL END)) /
 CIS2.NOZERO((CIS2.NVAL(MAX(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('100.01','100.02','100.03','100.04','100.05','100.06','100.07')THEN D.COL1 END ))))) AS COL3,

  CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.3.1') AND D.COL1=1 THEN D.COL1 END )) AS COL4,
  CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.3.2') AND D.COL1=1 THEN D.COL1 END )) AS COL5,
  
 (CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.3.1') AND D.COL1=1 THEN D.COL1 END ))+
  CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.3.2') AND D.COL1=1 THEN D.COL1 END ))/
  CIS2.NOZERO( CIS2.NVAL(MAX(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('100.01','100.02','100.03','100.04','100.05','100.06','100.07')THEN D.COL1 END ))))*100 AS COL6,
  
 (CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.3.1') AND D.COL1=1 THEN D.COL1 END ))+
  CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.3.2') AND D.COL1=1 THEN D.COL1 END ))/
  CIS2.NOZERO( CIS2.NVAL(MAX(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2', '1042.3.1.1','1042.3.1.2','1042.3.1.3','1046.7.1.1','1046.7.1.2','1046.7.1.3','1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') 
  AND D.COL1=1  THEN D.COL1 END))))*100 AS COL7,
 
  CIS2.NVAL(MAX(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2') AND D.COL1=1 THEN D.COL1 ELSE NULL END)) AS COL10,
  CIS2.NVAL(MAX(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1042.3.1.1','1042.3.1.2','1042.3.1.3') AND D.COL1=1 THEN D.COL1 ELSE NULL END)) AS COL11,
  CIS2.NVAL(MAX(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1046.7.1.1','1046.7.1.2','1046.7.1.3') AND D.COL1=1 THEN D.COL1 ELSE NULL END)) AS COL12,
  CIS2.NVAL(MAX(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 THEN D.COL1 ELSE NULL END)) AS COL13
  ----NEW

--  ROUND(((CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.3.3') THEN D.COL1 ELSE NULL END))+ CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.3.4') THEN D.COL1 ELSE NULL END)))*
--  ASA.GR1)/100,1) AS COL15,
--  
--  ROUND((CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.3.3') THEN D.COL1 ELSE NULL END))* ASA.GR1)/100,1) AS COL16,
--  ROUND((CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.3.4') THEN D.COL1 ELSE NULL END))* ASA.GR1)/100,1) AS COL17,
--
--  CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1044.5.2.6')  THEN D.COL1 ELSE NULL END))/1000 AS COL23,
--  CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1044.5.2.1')  THEN D.COL1 ELSE NULL END))/1000 AS COL24,
--  CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1044.5.2.2')  THEN D.COL1 ELSE NULL END))/1000 AS COL25,
--  CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1044.5.2.3')  THEN D.COL1 ELSE NULL END))/1000 AS COL26,
--  CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1044.5.2.4')  THEN D.COL1 ELSE NULL END))/1000 AS COL27,
--  CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1044.5.2.5')  THEN D.COL1 ELSE NULL END))/1000 AS COL28,
--  
--  CIS2.NVAL(MAX(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.2.1','1041.2.2.2','1042.3.2.1','1042.3.2.2') AND D.COL1=1 THEN D.COL1 ELSE NULL END)) AS COL31,
--  CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1043.4.1.1')  AND D.COL1=1 THEN D.COL1 ELSE NULL END)) AS COL33,
--  CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1043.4.1.2')  AND D.COL1=1 THEN D.COL1 ELSE NULL END)) AS COL34,
--  
--  CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.3.3') THEN D.COL1 ELSE NULL END)) AS COL233,
--  CIS2.NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.3.4') THEN D.COL1 ELSE NULL END)) AS COL234,
--  
--  
--  
--  CIS2.NVAL(COUNT( DISTINCT CASE WHEN D.CAPITOL||'.'||D.RIND IN ('100.02','100.03','100.04','100.05','100.06','100.07')THEN D.CUIIO END )) AS COL37,
--  CIS2.NVAL(COUNT( DISTINCT CASE WHEN D.CAPITOL||'.'||D.RIND IN ('100.01') THEN D.CUIIO END )) AS COL39,
--  
--  
---------------------------   
--  ASA.GR1 AS COL14
  
  FROM 
  CIS2.VW_DATA_ALL D  
--  LEFT JOIN 
--  (
--    SELECT DISTINCT
--      ASA.CUIIO,
--      ASA.GR1
--    FROM
--      ASA4.DATELE_03 ASA  
--    WHERE
--      ASA.ANUL IN (2016) AND
--      ASA.RIND IN ('340')
--  ) ASA 
--   ON (ASA.CUIIO=D.CUIIO)   
  INNER JOIN CIS2.VW_CL_CUATM CC ON (D.CUATM=CC.CODUL)
    CROSS JOIN 
  (
    SELECT
      DECODE(CS.CODUL, 
      '0000000','01',
      '0100000','02','1111111','03','0300000','04',
      '1400000','05','3400000','06','3600000','07','4100000','08','4300000','09',
      '4500000','10','4800000','11','6200000','12','7100000','13','7400000','14',
      '7800000','15','2222222','16','1000000','17','2500000','18','3100000','19',
      '3800000','20','5300000','21','5500000','22','6000000','23','6400000','24',
      '6700000','25','8000000','26','8300000','27','8900000','28','9200000','29',
      '3333333','30','1200000','31','1700000','32','2100000','33','2700000','34',
      '2900000','35','5700000','36','8500000','37','8700000','38','9600000','39',
      '9601000','40')
      AS NR_ROW,
      CS.DENUMIRE AS NUME_ROW,
      CS.CODUL AS CS_CUATM
    FROM
      CIS2.VW_CL_CUATM CS
    WHERE
      CS.CODUL 
      IN(
         '0000000',
         '0100000','1111111','0300000','1400000','3400000','3600000','4100000','4300000','4500000',
         '4800000','6200000','7100000','7400000','7800000','2222222','1000000','2500000','3100000','3800000',
         '5300000','5500000','6000000','6400000','6700000','8000000','8300000','8900000','9200000','3333333',
         '1200000','1700000','2100000','2700000','2900000','5700000','8500000','8700000','9600000','9601000')
  ) CTM 
   
  
WHERE
  D.PERIOADA IN (:pPERIOADA) AND 
  D.FORM_VERS = :pFORM_VERS     AND   
  D.FORM= :pFORM     AND    
  (:pID_MDTABLE=:pID_MDTABLE) AND
  D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%' AND  
  CC.FULL_CODE LIKE '%'||CTM.CS_CUATM||'%' AND 
  D.FORM IN (48)  

  
GROUP BY  
  CTM.NR_ROW,
  CTM.NUME_ROW,D.CUIIO)
  
  
  GROUP BY
  NR_SECTIE,
  NUME_SECTIE 
  
  ORDER BY 
   NR_SECTIE