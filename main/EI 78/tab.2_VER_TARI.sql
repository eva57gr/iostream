
SELECT *

FROM
(
SELECT
L.SHOW_ORDER||'.'||ROWNUM SHOW_ORDER,
L.ITEM_PARENT,
L.ITEM_PATH,
L.NAME,
L.NR_ROW,
L.NUME_ROW,
L.COL1,
L.COL2,
L.COL3,
L.COL4
FROM

(
SELECT 
R.SHOW_ORDER,
R.ITEM_PARENT,
R.ITEM_PATH,
R.NAME,
L.NR_ROW,
L.NUME_ROW,
L.COL1,
L.COL2,
L.COL3,
L.COL4
FROM
(
SELECT 
NR_ROW, 
NUME_ROW,
SUM(COL1) AS COL1,
SUM(COL2) AS COL2,
SUM(COL3) AS COL3,
SUM(COL4) AS COL4
FROM

(SELECT 
ROWNUM ORDINE2,
ORDINE,
NR_ROW, 
NUME_ROW,
SUM(COL1) AS COL1,
SUM(COL2) AS COL2,
SUM(COL3) AS COL3,
SUM(COL4) AS COL4
FROM
(
SELECT
ORDINE,
SUBSTR(NR_ROW, 1, INSTR(NR_ROW, '~') - 1) AS NR_ROW,
NUME_ROW,
D.COL1 AS COL1,
D.COL2 AS COL2,
D.COL3 AS COL3, 
D.COL4 AS COL4



FROM CIS2.TABLE_OUT D


WHERE 
D.ID_MDTABLE = 12100 AND 
--D.PERIOADA IN (:pPERIOADA) AND 
 (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA)  AND  
 D.FORM = (:pFORM)  AND 

  (D.COD_CUATM LIKE '%'||:pCOD_CUATM||'%') 

ORDER BY 
ORDINE
)


GROUP BY 
ORDINE,

NR_ROW, 
NUME_ROW,
ROWNUM
ORDER BY 
ORDINE

)


GROUP BY
--ORDINE2,
NR_ROW, 
NUME_ROW
 ) L   LEFT JOIN     (
    
    SELECT 
    ITEM_CODE,
    ITEM_PARENT,
    ITEM_PATH,
    SHOW_ORDER,
    NAME
 
   FROM VW_CLS_CLASS_ITEM CII 
   
   WHERE 
   CII.CLASS_CODE IN ('CSPM2')) R ON (R.ITEM_CODE = L.NR_ROW 
   AND  TRIM(R.NAME) <>  TRIM(L.NUME_ROW)) 
   
   
   ORDER BY
   R.SHOW_ORDER


) L

 
  
)  


ORDER BY 
ITEM_PATH