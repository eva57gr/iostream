--Adauga coloanele in continuare dupa logica existenta

--0100000	MUN.CHISINAU
--0300000	MUN.BALTI
--1400000	R-UL BRICENI
--3400000	R-UL DONDUSENI
--3600000	R-UL DROCHIA
--4100000	R-UL EDINET
--4300000	R-UL FALESTI
--4500000	R-UL FLORESTI
--4800000	R-UL GLODENI
--6200000	R-UL OCNITA
--7100000	R-UL RISCANI
--7400000	R-UL SINGEREI
--7800000	R-UL SOROCA
--1000000	R-UL ANENII NOI
--2500000	R-UL CALARASI
--3100000	R-UL CRIULENI
--3800000	R-UL DUBASARI
--5300000	R-UL HINCESTI
--5500000	R-UL IALOVENI
--6000000	R-UL NISPORENI
--6400000	R-UL ORHEI
--6700000	R-UL REZINA
--8000000	R-UL STRASENI
--8300000	R-UL SOLDANESTI
--8900000	R-UL TELENESTI
--9200000	R-UL UNGHENI
--1200000	R-UL BASARABEASCA
--1700000	R-UL CAHUL
--2100000	R-UL CANTEMIR
--2700000	R-UL CAUSENI
--2900000	R-UL CIMISLIA
--5700000	R-UL LEOVA
--8500000	R-UL STEFAN VODA
--8700000	R-UL TARACLIA
--9600000	UTA GAGAUZIA
--9800000	UATdS NISTRULUI
--

SELECT 
      CII.SHOW_ORDER   AS ORDINE, 
      CII.ITEM_CODE, 
      CII.NAME NUME_ROW,
    COUNT(DISTINCT CASE WHEN D.CAPITOL IN (405) AND D.RIND NOT IN ('1','-') AND CIS2.NVAL(D.COL4) > 0 THEN D.CUIIO END) AS COL_TOTAL,
    COUNT(DISTINCT CASE WHEN D.CAPITOL IN (405) AND D.RIND NOT IN ('1','-') AND C.FULL_CODE LIKE '%'||'0100000'||'%' AND CIS2.NVAL(D.COL4) > 0 THEN D.CUIIO END) AS COL_01,
    COUNT(DISTINCT CASE WHEN D.CAPITOL IN (405) AND D.RIND NOT IN ('1','-') AND C.FULL_CODE LIKE '%'||'0300000'||'%' AND CIS2.NVAL(D.COL4) > 0 THEN D.CUIIO END) AS COL_03,
    COUNT(DISTINCT CASE WHEN D.CAPITOL IN (405) AND D.RIND NOT IN ('1','-') AND C.FULL_CODE LIKE '%'||'1400000'||'%' AND CIS2.NVAL(D.COL4) > 0 THEN D.CUIIO END) AS COL_14
    

    
     FROM VW_DATA_ALL D
       
           INNER JOIN VW_CLS_CLASS_ITEM CI ON (CI.CLASS_CODE IN ('CSPM2') AND TRIM(D.COL31)=TRIM(CI.ITEM_CODE))
           INNER JOIN VW_CLS_CLASS_ITEM CII ON (CII.CLASS_CODE IN ('CSPM2')
           AND REPLACE(' '||CI.ITEM_PATH,';','; ') LIKE '% '||TRIM(CII.ITEM_CODE)||';%')
         --  INNER JOIN   CIS2.VW_CL_TARI TT  ON (TT.CODUL=D.COL33)
         INNER JOIN CIS2.VW_CL_CUATM C ON (D.CUATM=C.CODUL )
  
         
   WHERE 
  (D.PERIOADA =:pPERIOADA) AND 
  (D.FORM =:pFORM) AND
  (D.FORM_VERS =:pFORM_VERS) AND 
  --(:pID_MDTABLE =:pID_MDTABLE) AND
  --(D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%') AND
  D.FORM IN (44)
  AND D.CAPITOL IN (405) 
  
  GROUP BY 
  CII.ITEM_CODE,
  CII.SHOW_ORDER,  
  CII.NAME
  
  

ORDER BY
CII.SHOW_ORDER


  

  




  
