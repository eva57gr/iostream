SELECT 
  D.CODUL,
  D.FULL_CODE,
  D.DENUMIRE,
  D.CUIIO,
  R.IDNO IDNO,
  
 -- D.IDNO,
  D.DENUMIRE_CUIIO,
  D.CFP, 
  D.RIND,
D.CAP2_1_COL1,
D.CAP2_1_COL2,
D.CAP2_1_COL3,
D.CAP2_1_COL4,
D.CAP2_1_COL5,
D.CAP2_1_COL6,
D.CAP2_1_COL7,
D.CAP2_1_COL8,
--,
--D.CAP2_1_COL9,

D.CAP2_2_COL1,
D.CAP2_2_COL2,
D.CAP2_2_COL3,
D.CAP2_2_COL4,
D.CAP2_2_COL5,
D.CAP2_2_COL6,
D.CAP2_2_COL7

--D.CAP2_3_COL1,
--D.CAP2_3_COL2,
--D.CAP2_3_COL3,
--D.CAP2_3_COL4,
--D.CAP2_3_COL5,
--D.CAP2_3_COL6,
--D.CAP2_3_COL7,
--D.CAP2_3_COL8,
--D.CAP2_3_COL9


--D.CAP2_3_COL10,
--D.CAP2_3_COL11,
--D.CAP2_3_COL12,
--D.CAP2_3_COL13,
--D.CAP2_3_COL14,
--D.CAP2_3_COL15,
--D.CAP2_3_COL16,
--D.CAP2_3_COL17
--  

FROM

(

SELECT

  C.CODUL,
  C.FULL_CODE,
  C.DENUMIRE,
  NULL CUIIO,
  NULL IDNO,
  NULL DENUMIRE_CUIIO,
  NULL AS CFP,
  NULL RIND,



NULL CAP2_1_COL1,
NULL CAP2_1_COL2,
NULL CAP2_1_COL3,
NULL CAP2_1_COL4,
NULL CAP2_1_COL5,
NULL CAP2_1_COL6,
NULL CAP2_1_COL7,
NULL CAP2_1_COL8,
NULL CAP2_1_COL9,
NULL CAP2_1_COL10,

NULL CAP2_2_COL1,
NULL CAP2_2_COL2,
NULL CAP2_2_COL3,
NULL CAP2_2_COL4,
NULL CAP2_2_COL5,
NULL CAP2_2_COL6,
NULL CAP2_2_COL7


--NULL CAP2_3_COL1,
--NULL CAP2_3_COL2,
--NULL CAP2_3_COL3,
--NULL CAP2_3_COL4,
--NULL CAP2_3_COL5,
--NULL CAP2_3_COL6,
--NULL CAP2_3_COL7,
--NULL CAP2_3_COL8,
--NULL CAP2_3_COL9,
--NULL CAP2_3_COL10,
--NULL CAP2_3_COL11,
--NULL CAP2_3_COL12,
--NULL CAP2_3_COL13,
--NULL CAP2_3_COL14,
--NULL CAP2_3_COL15,
--NULL CAP2_3_COL16,
--NULL CAP2_3_COL17
   

        FROM  CIS2.VW_CL_CUATM C
        
        
            WHERE 
            
            C.PRGS IN ('2')
                
            
            GROUP BY 
              C.CODUL,
  C.FULL_CODE,
  C.DENUMIRE
  
 UNION 
 
 SELECT
  C.CODUL,
  C.FULL_CODE,
  C.DENUMIRE,
  D.CUIIO,
  
  R.IDNO,
  R.DENUMIRE DENUMIRE_CUIIO,
  R.CFP, 
  D.RIND,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1037) THEN D.COL1 ELSE 0 END),1) AS CAP2_1_COL1,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1037) THEN D.COL2 ELSE 0 END),1) AS CAP2_1_COL2,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1037) THEN D.COL3 ELSE 0 END),1) AS CAP2_1_COL3,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1037) THEN D.COL4 ELSE 0 END),1) AS CAP2_1_COL4,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1037) THEN D.COL5 ELSE 0 END),1) AS CAP2_1_COL5,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1037) THEN D.COL6 ELSE 0 END),1) AS CAP2_1_COL6,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1037) THEN D.COL7 ELSE 0 END),1) AS CAP2_1_COL7,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1037) THEN D.COL8 ELSE 0 END),1) AS CAP2_1_COL8,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1037) THEN D.COL9 ELSE 0 END),1) AS CAP2_1_COL9,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1037) THEN D.COL10 ELSE 0 END),1) AS CAP2_1_COL10,
  
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1038) THEN D.COL1 ELSE 0 END),1) AS CAP2_2_COL1,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1038) THEN D.COL2 ELSE 0 END),1) AS CAP2_2_COL2,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1038) THEN D.COL3 ELSE 0 END),1) AS CAP2_2_COL3,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1038) THEN D.COL4 ELSE 0 END),1) AS CAP2_2_COL4,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1038) THEN D.COL5 ELSE 0 END),1) AS CAP2_2_COL5,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1038) THEN D.COL6 ELSE 0 END),1) AS CAP2_2_COL6,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1038) THEN D.COL7 ELSE 0 END),1) AS CAP2_2_COL7
 
  
  
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL1 ELSE 0 END),1) AS CAP2_3_COL1,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL2 ELSE 0 END),1) AS CAP2_3_COL2,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL3 ELSE 0 END),1) AS CAP2_3_COL3,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL4 ELSE 0 END),1) AS CAP2_3_COL4,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL5 ELSE 0 END),1) AS CAP2_3_COL5,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL6 ELSE 0 END),1) AS CAP2_3_COL6,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL7 ELSE 0 END),1) AS CAP2_3_COL7,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL8 ELSE 0 END),1) AS CAP2_3_COL8,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL9 ELSE 0 END),1) AS CAP2_3_COL9,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL10 ELSE 0 END),1) AS CAP2_3_COL10,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL11 ELSE 0 END),1) AS CAP2_3_COL11,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL12 ELSE 0 END),1) AS CAP2_3_COL12,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL13 ELSE 0 END),1) AS CAP2_3_COL13,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL14 ELSE 0 END),1) AS CAP2_3_COL14,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL15 ELSE 0 END),1) AS CAP2_3_COL15,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL16 ELSE 0 END),1) AS CAP2_3_COL16,
--  ROUND(SUM(CASE WHEN D.CAPITOL IN (1039) THEN D.COL17 ELSE 0 END),1) AS CAP2_3_COL17
 
  

    FROM CIS2.VW_DATA_ALL D 
    
            INNER JOIN CIS2.VW_CL_CUATM C ON C.CODUL = D.CUATM
            INNER JOIN CIS2.RENIM R ON R.CUIIO = D.CUIIO AND R.CUIIO_VERS = D.CUIIO_VERS 
    
    WHERE 
    
    D.PERIOADA IN (:pPERIOADA)
    AND D.FORM IN (:pFORM)    
    AND D.CAPITOL IN (1037,1038,1039)
    AND D.RIND IN ('0000000')

   
    
GROUP BY 
  C.CODUL,
  C.FULL_CODE,
  C.DENUMIRE,
  D.CUIIO,
  R.DENUMIRE,
  R.CFP,
  D.RIND,
  R.IDNO
  
  ) D  
  
    LEFT JOIN (

SELECT 
    CUIIO,
    IDNO

                    FROM  USER_BANCU.VW_MAX_RENIM_CIS2
) R ON D.CUIIO = R.CUIIO  


WHERE 
1=1
--AND D.DENUMIRE LIKE '%R-UL%'



ORDER BY 
FULL_CODE