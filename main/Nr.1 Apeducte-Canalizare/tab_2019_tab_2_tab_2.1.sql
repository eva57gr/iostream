

SELECT 
  D.CODUL,
  D.FULL_CODE,
  D.DENUMIRE,
  D.CUIIO,
  R.IDNO IDNO,
  
--  D.IDNO,
  D.DENUMIRE_CUIIO,
  D.CFP, 
  D.RIND, 
  D.COL1 tab_2_col_3,
  D.COL2 tab_2_col_7,
  D.COL3 tab_2_1_col_11,
  D.COL4 tab_2_1_col_15
--  D.COL5 tab_1_1_col_14,
--  D.COL6 tab_1_1_col_15,
--  D.COL7 tab_1_1_col_16,
--  D.COL8 tab_1_1_col_17,
--  D.COL9 tab_1_1_col_18,
--  D.COL10 tab_1_1_col_19

FROM

(

SELECT

  C.CODUL,
  C.FULL_CODE,
  C.DENUMIRE,
  NULL CUIIO,
  NULL IDNO,
  NULL DENUMIRE_CUIIO,
  NULL AS CFP,
  NULL RIND,
  NULL AS COL1,
  NULL AS COL2,
  NULL AS COL3,
  NULL AS COL4,
  NULL AS COL5,
  NULL AS COL6,
  NULL AS COL7,
  NULL AS COL8,         
  NULL AS COL9,
  NULL AS COL10

    

        FROM  CIS2.VW_CL_CUATM C
        
        
            WHERE 
            
            C.PRGS IN ('2')
                
            
            GROUP BY 
              C.CODUL,
  C.FULL_CODE,
  C.DENUMIRE
  


UNION 

SELECT 

  CODUL,
  FULL_CODE,
  DENUMIRE,
  CUIIO,
  
  IDNO,
  DENUMIRE_CUIIO,
  CFP, 
  RIND,
  SUM(COL1) AS COL1,
  SUM(COL2) AS COL2,
  SUM(COL3) AS COL3,
  SUM(COL4) AS COL4,
  SUM(COL5) AS COL5,
  SUM(COL6) AS COL6,
  SUM(COL7) AS COL7,
  SUM(COL8) AS COL8,
  SUM(COL9) AS COL9,
  SUM(COL10) AS COL10

FROM 



(

SELECT
  C.CODUL,
  C.FULL_CODE,
  C.DENUMIRE,
  D.CUIIO,
  
  R.IDNO,
  R.DENUMIRE DENUMIRE_CUIIO,
  R.CFP, 
  D.RIND,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1037) THEN D.COL3 ELSE 0 END),1) AS COL1,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1037) THEN D.COL7 ELSE 0 END),1) AS COL2,
  NULL AS COL3,
  NULL AS COL4,
  NULL AS COL5,
  NULL AS COL6,
  NULL AS COL7,
  NULL AS COL8,
  NULL AS COL9,
  NULL AS COL10         
 
  

    FROM CIS2.VW_DATA_ALL D 
    
            INNER JOIN CIS2.VW_CL_CUATM C ON C.CODUL = D.CUATM
            INNER JOIN CIS2.RENIM R ON R.CUIIO = D.CUIIO AND R.CUIIO_VERS = D.CUIIO_VERS 
    
    WHERE 
    
    D.PERIOADA IN (:pPERIOADA)
    AND D.FORM IN (:pFORM)    
    AND D.CAPITOL IN (1037)
    AND D.RIND IN ('0000000')
--     AND
--   D.CUIIO= 38923807 
   
    
GROUP BY 
  C.CODUL,
  C.FULL_CODE,
  C.DENUMIRE,
  D.CUIIO,
  R.DENUMIRE,
  R.CFP,
  D.RIND,
  R.IDNO
  
  UNION 
  
  SELECT
  C.CODUL,
  C.FULL_CODE,
  C.DENUMIRE,
  D.CUIIO,
  
  R.IDNO,
  R.DENUMIRE DENUMIRE_CUIIO,
  R.CFP, 
  D.RIND,
  NULL AS COL1,
  NULL AS COL2,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1038) THEN D.COL3 ELSE 0 END),1) AS COL3,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1038) THEN D.COL7 ELSE 0 END),1) AS COL4,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1035) THEN D.COL6 ELSE 0 END),1) AS COL5,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1035) THEN D.COL7 ELSE 0 END),1) AS COL6,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1035) THEN D.COL8 ELSE 0 END),1) AS COL7,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1035) THEN D.COL9 ELSE 0 END),1) AS COL8,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1035) THEN D.COL10 ELSE 0 END),1) AS COL9,
  ROUND(SUM(CASE WHEN D.CAPITOL IN (1035) THEN D.COL11 ELSE 0 END),1) AS COL10

 
  

    FROM CIS2.VW_DATA_ALL D 
    
            INNER JOIN CIS2.VW_CL_CUATM C ON C.CODUL = D.CUATM
            INNER JOIN CIS2.RENIM R ON R.CUIIO = D.CUIIO AND R.CUIIO_VERS = D.CUIIO_VERS 
    
    WHERE 
    
    D.PERIOADA IN (:pPERIOADA)
    AND D.FORM IN (:pFORM)    
    AND D.CAPITOL IN (1038)
    AND D.RIND IN ('0000000')
--     AND
--   D.CUIIO= 38923807 
   
    
GROUP BY 
  C.CODUL,
  C.FULL_CODE,
  C.DENUMIRE,
  D.CUIIO,
  R.DENUMIRE,
  R.CFP,
  D.RIND,
  R.IDNO
  
  
  ORDER BY CUIIO  
  
  
  )
  
  GROUP BY 
    CODUL,
  FULL_CODE,
  DENUMIRE,
  CUIIO,
  
  IDNO,
  DENUMIRE,
  CFP, 
  RIND,
   DENUMIRE_CUIIO
  


ORDER BY 
FULL_CODE


) D  LEFT JOIN (

SELECT 
    CUIIO,
    IDNO

                    FROM  USER_BANCU.VW_MAX_RENIM_CIS2
) R ON D.CUIIO = R.CUIIO  

WHERE 
1=1
--AND D.DENUMIRE LIKE '%R-UL%'

ORDER BY 
FULL_CODE

        

