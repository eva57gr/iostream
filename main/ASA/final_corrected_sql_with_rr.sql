
WITH RR AS (
    SELECT '10' AS NR_ROW, 'Col1' AS COL FROM DUAL UNION ALL SELECT '20' AS NR_ROW, 'Col2' AS COL FROM DUAL UNION ALL SELECT '30' AS NR_ROW, 'Col3' AS COL FROM DUAL UNION ALL SELECT '40' AS NR_ROW, 'Col4' AS COL FROM DUAL UNION ALL SELECT '50' AS NR_ROW, 'Col5' AS COL FROM DUAL UNION ALL SELECT '60' AS NR_ROW, 'Col6' AS COL FROM DUAL UNION ALL SELECT '70' AS NR_ROW, 'Col7' AS COL FROM DUAL UNION ALL SELECT '80' AS NR_ROW, 'Col8' AS COL FROM DUAL UNION ALL SELECT '90' AS NR_ROW, 'Col9' AS COL FROM DUAL UNION ALL SELECT '100' AS NR_ROW, 'Col10' AS COL FROM DUAL UNION ALL SELECT '110' AS NR_ROW, 'Col11' AS COL FROM DUAL UNION ALL SELECT '120' AS NR_ROW, 'Col12' AS COL FROM DUAL UNION ALL SELECT '130' AS NR_ROW, 'Col13' AS COL FROM DUAL UNION ALL SELECT '140' AS NR_ROW, 'Col14' AS COL FROM DUAL UNION ALL SELECT '150' AS NR_ROW, 'Col15' AS COL FROM DUAL UNION ALL SELECT '160' AS NR_ROW, 'Col16' AS COL FROM DUAL UNION ALL SELECT '170' AS NR_ROW, 'Col17' AS COL FROM DUAL UNION ALL SELECT '180' AS NR_ROW, 'Col18' AS COL FROM DUAL UNION ALL SELECT '190' AS NR_ROW, 'Col19' AS COL FROM DUAL UNION ALL SELECT '200' AS NR_ROW, 'Col20' AS COL FROM DUAL UNION ALL SELECT '210' AS NR_ROW, 'Col21' AS COL FROM DUAL UNION ALL SELECT '220' AS NR_ROW, 'Col22' AS COL FROM DUAL UNION ALL SELECT '230' AS NR_ROW, 'Col23' AS COL FROM DUAL UNION ALL SELECT '240' AS NR_ROW, 'Col24' AS COL FROM DUAL UNION ALL SELECT '250' AS NR_ROW, 'Col25' AS COL FROM DUAL UNION ALL SELECT '260' AS NR_ROW, 'Col26' AS COL FROM DUAL UNION ALL SELECT '270' AS NR_ROW, 'Col27' AS COL FROM DUAL UNION ALL SELECT '280' AS NR_ROW, 'Col28' AS COL FROM DUAL UNION ALL SELECT '290' AS NR_ROW, 'Col29' AS COL FROM DUAL UNION ALL SELECT '300' AS NR_ROW, 'Col30' AS COL FROM DUAL UNION ALL SELECT '310' AS NR_ROW, 'Col31' AS COL FROM DUAL UNION ALL SELECT '320' AS NR_ROW, 'Col32' AS COL FROM DUAL UNION ALL SELECT '330' AS NR_ROW, 'Col33' AS COL FROM DUAL UNION ALL SELECT '340' AS NR_ROW, 'Col34' AS COL FROM DUAL UNION ALL SELECT '350' AS NR_ROW, 'Col35' AS COL FROM DUAL UNION ALL SELECT '360' AS NR_ROW, 'Col36' AS COL FROM DUAL UNION ALL SELECT '370' AS NR_ROW, 'Col37' AS COL FROM DUAL UNION ALL SELECT '380' AS NR_ROW, 'Col38' AS COL FROM DUAL UNION ALL SELECT '390' AS NR_ROW, 'Col39' AS COL FROM DUAL UNION ALL SELECT '400' AS NR_ROW, 'Col40' AS COL FROM DUAL UNION ALL SELECT '410' AS NR_ROW, 'Col41' AS COL FROM DUAL UNION ALL SELECT '420' AS NR_ROW, 'Col42' AS COL FROM DUAL UNION ALL SELECT '430' AS NR_ROW, 'Col43' AS COL FROM DUAL UNION ALL SELECT '440' AS NR_ROW, 'Col44' AS COL FROM DUAL UNION ALL SELECT '450' AS NR_ROW, 'Col45' AS COL FROM DUAL UNION ALL SELECT '460' AS NR_ROW, 'Col46' AS COL FROM DUAL UNION ALL SELECT '470' AS NR_ROW, 'Col47' AS COL FROM DUAL UNION ALL SELECT '480' AS NR_ROW, 'Col48' AS COL FROM DUAL UNION ALL SELECT '490' AS NR_ROW, 'Col49' AS COL FROM DUAL UNION ALL SELECT '500' AS NR_ROW, 'Col50' AS COL FROM DUAL UNION ALL SELECT '510' AS NR_ROW, 'Col51' AS COL FROM DUAL UNION ALL SELECT '520' AS NR_ROW, 'Col52' AS COL FROM DUAL UNION ALL SELECT '530' AS NR_ROW, 'Col53' AS COL FROM DUAL UNION ALL SELECT '540' AS NR_ROW, 'Col54' AS COL FROM DUAL UNION ALL SELECT '550' AS NR_ROW, 'Col55' AS COL FROM DUAL UNION ALL SELECT '560' AS NR_ROW, 'Col56' AS COL FROM DUAL UNION ALL SELECT '570' AS NR_ROW, 'Col57' AS COL FROM DUAL UNION ALL SELECT '580' AS NR_ROW, 'Col58' AS COL FROM DUAL UNION ALL SELECT '590' AS NR_ROW, 'Col59' AS COL FROM DUAL UNION ALL SELECT '600' AS NR_ROW, 'Col60' AS COL FROM DUAL
),
MAIN_QUERY AS (
    SELECT DISTINCT D.CUIIO, 
        CASE WHEN MAX(CASE WHEN D.RIND IN ('8') AND D.CAPITOL IN (1129) THEN D.COL31 END) IS NULL 
            THEN MAX(SUBSTR(D.CAEM2,2,4)) 
            ELSE MAX(CASE WHEN D.RIND IN ('8') AND D.CAPITOL IN (1129) THEN D.COL31 END) 
        END AS CAEM2_ACTUALIZAT,
        MAX(SUBSTR(D.CAEM2,2,4))  AS CAEM2,
        D.CUIIO_VERS, 
        D.CUATM, D.FORM, D.FORM_VERS, D.CUATM_FULL, D.PERIOADA,
        CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('10') THEN CIS2.NVAL(D.COL1) END)) AS Col1, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('20') THEN CIS2.NVAL(D.COL1) END)) AS Col2, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('30') THEN CIS2.NVAL(D.COL1) END)) AS Col3, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('40') THEN CIS2.NVAL(D.COL1) END)) AS Col4, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('50') THEN CIS2.NVAL(D.COL1) END)) AS Col5, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('60') THEN CIS2.NVAL(D.COL1) END)) AS Col6, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('70') THEN CIS2.NVAL(D.COL1) END)) AS Col7, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('80') THEN CIS2.NVAL(D.COL1) END)) AS Col8, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('90') THEN CIS2.NVAL(D.COL1) END)) AS Col9, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('100') THEN CIS2.NVAL(D.COL1) END)) AS Col10, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('110') THEN CIS2.NVAL(D.COL1) END)) AS Col11, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('120') THEN CIS2.NVAL(D.COL1) END)) AS Col12, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('130') THEN CIS2.NVAL(D.COL1) END)) AS Col13, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('140') THEN CIS2.NVAL(D.COL1) END)) AS Col14, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('150') THEN CIS2.NVAL(D.COL1) END)) AS Col15, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('160') THEN CIS2.NVAL(D.COL1) END)) AS Col16, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('170') THEN CIS2.NVAL(D.COL1) END)) AS Col17, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('180') THEN CIS2.NVAL(D.COL1) END)) AS Col18, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('190') THEN CIS2.NVAL(D.COL1) END)) AS Col19, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('200') THEN CIS2.NVAL(D.COL1) END)) AS Col20, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('210') THEN CIS2.NVAL(D.COL1) END)) AS Col21, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('220') THEN CIS2.NVAL(D.COL1) END)) AS Col22, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('230') THEN CIS2.NVAL(D.COL1) END)) AS Col23, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('240') THEN CIS2.NVAL(D.COL1) END)) AS Col24, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('250') THEN CIS2.NVAL(D.COL1) END)) AS Col25, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('260') THEN CIS2.NVAL(D.COL1) END)) AS Col26, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('270') THEN CIS2.NVAL(D.COL1) END)) AS Col27, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('280') THEN CIS2.NVAL(D.COL1) END)) AS Col28, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('290') THEN CIS2.NVAL(D.COL1) END)) AS Col29, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('300') THEN CIS2.NVAL(D.COL1) END)) AS Col30, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('310') THEN CIS2.NVAL(D.COL1) END)) AS Col31, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('320') THEN CIS2.NVAL(D.COL1) END)) AS Col32, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('330') THEN CIS2.NVAL(D.COL1) END)) AS Col33, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('340') THEN CIS2.NVAL(D.COL1) END)) AS Col34, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('350') THEN CIS2.NVAL(D.COL1) END)) AS Col35, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('360') THEN CIS2.NVAL(D.COL1) END)) AS Col36, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('370') THEN CIS2.NVAL(D.COL1) END)) AS Col37, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('380') THEN CIS2.NVAL(D.COL1) END)) AS Col38, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('390') THEN CIS2.NVAL(D.COL1) END)) AS Col39, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('400') THEN CIS2.NVAL(D.COL1) END)) AS Col40, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('410') THEN CIS2.NVAL(D.COL1) END)) AS Col41, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('420') THEN CIS2.NVAL(D.COL1) END)) AS Col42, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('430') THEN CIS2.NVAL(D.COL1) END)) AS Col43, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('440') THEN CIS2.NVAL(D.COL1) END)) AS Col44, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('450') THEN CIS2.NVAL(D.COL1) END)) AS Col45, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('460') THEN CIS2.NVAL(D.COL1) END)) AS Col46, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('470') THEN CIS2.NVAL(D.COL1) END)) AS Col47, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('480') THEN CIS2.NVAL(D.COL1) END)) AS Col48, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('490') THEN CIS2.NVAL(D.COL1) END)) AS Col49, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('500') THEN CIS2.NVAL(D.COL1) END)) AS Col50, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('510') THEN CIS2.NVAL(D.COL1) END)) AS Col51, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('520') THEN CIS2.NVAL(D.COL1) END)) AS Col52, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('530') THEN CIS2.NVAL(D.COL1) END)) AS Col53, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('540') THEN CIS2.NVAL(D.COL1) END)) AS Col54, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('550') THEN CIS2.NVAL(D.COL1) END)) AS Col55, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('560') THEN CIS2.NVAL(D.COL1) END)) AS Col56, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('570') THEN CIS2.NVAL(D.COL1) END)) AS Col57, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('580') THEN CIS2.NVAL(D.COL1) END)) AS Col58, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('590') THEN CIS2.NVAL(D.COL1) END)) AS Col59, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('600') THEN CIS2.NVAL(D.COL1) END)) AS Col60
    FROM CIS2.VW_DATA_ALL_COEF D       
    WHERE
        D.FORM IN (64) AND 
        D.FORM_VERS = :PFORM_VERS AND      
        D.PERIOADA = :pPERIOADA AND
        D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%' AND
        D.CAPITOL IN (100,1123,1124,1125,1126,1127,1128,1129) 
        AND D.CUIIO IN (26844)
    GROUP BY D.CUIIO, D.CUIIO_VERS, D.CUATM, D.FORM, D.FORM_VERS, D.CUATM_FULL, D.PERIOADA
)
SELECT 
    RR.NR_ROW,
    ROUND(SUM(CASE 
        WHEN '10' THEN DD.Col1WHEN '20' THEN DD.Col2WHEN '30' THEN DD.Col3WHEN '40' THEN DD.Col4WHEN '50' THEN DD.Col5WHEN '60' THEN DD.Col6WHEN '70' THEN DD.Col7WHEN '80' THEN DD.Col8WHEN '90' THEN DD.Col9WHEN '100' THEN DD.Col10WHEN '110' THEN DD.Col11WHEN '120' THEN DD.Col12WHEN '130' THEN DD.Col13WHEN '140' THEN DD.Col14WHEN '150' THEN DD.Col15WHEN '160' THEN DD.Col16WHEN '170' THEN DD.Col17WHEN '180' THEN DD.Col18WHEN '190' THEN DD.Col19WHEN '200' THEN DD.Col20WHEN '210' THEN DD.Col21WHEN '220' THEN DD.Col22WHEN '230' THEN DD.Col23WHEN '240' THEN DD.Col24WHEN '250' THEN DD.Col25WHEN '260' THEN DD.Col26WHEN '270' THEN DD.Col27WHEN '280' THEN DD.Col28WHEN '290' THEN DD.Col29WHEN '300' THEN DD.Col30WHEN '310' THEN DD.Col31WHEN '320' THEN DD.Col32WHEN '330' THEN DD.Col33WHEN '340' THEN DD.Col34WHEN '350' THEN DD.Col35WHEN '360' THEN DD.Col36WHEN '370' THEN DD.Col37WHEN '380' THEN DD.Col38WHEN '390' THEN DD.Col39WHEN '400' THEN DD.Col40WHEN '410' THEN DD.Col41WHEN '420' THEN DD.Col42WHEN '430' THEN DD.Col43WHEN '440' THEN DD.Col44WHEN '450' THEN DD.Col45WHEN '460' THEN DD.Col46WHEN '470' THEN DD.Col47WHEN '480' THEN DD.Col48WHEN '490' THEN DD.Col49WHEN '500' THEN DD.Col50WHEN '510' THEN DD.Col51WHEN '520' THEN DD.Col52WHEN '530' THEN DD.Col53WHEN '540' THEN DD.Col54WHEN '550' THEN DD.Col55WHEN '560' THEN DD.Col56WHEN '570' THEN DD.Col57WHEN '580' THEN DD.Col58WHEN '590' THEN DD.Col59WHEN '600' THEN DD.Col60
        ELSE 0 END), 1) AS COL1
FROM RR
LEFT JOIN MAIN_QUERY DD ON 1 = 1
WHERE 
    (DD.FORM = :pFORM) AND
    (DD.FORM_VERS = :pFORM_VERS) AND
    (:pID_MDTABLE = :pID_MDTABLE) AND
    (DD.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%') AND   
    DD.PERIOADA IN (:pPERIOADA) AND
    DD.CUIIO = 26844
GROUP BY
    RR.NR_ROW
ORDER BY 
    RR.NR_ROW;
