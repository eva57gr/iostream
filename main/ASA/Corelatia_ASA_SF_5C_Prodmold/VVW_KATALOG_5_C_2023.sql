--DROP VIEW USER_BANCU.VVW_KATALOG_5_C_2023;

CREATE OR REPLACE FORCE VIEW USER_BANCU.VVW_KATALOG_5_C_2023
(CUIIO,
--, DENUMIRE, CUATM, 
CAEM2,
--, FULL_CODE, 
 CAP_1_R_2000_1, CAP_1_R_2000_2, CAP_1_R_2300_1, CAP_1_R_2300_2, CAP_1_R_2400_1, 
 CAP_1_R_2400_2, CAP_1_R_2500_1, CAP_1_R_2500_2, RIND_0100, RIND_0101, 
 RIND_0102, RIND_0103, RIND_0110, RIND_0120, RIND_0121, 
 RIND_0122, RIND_0130, RIND_0131, RIND_0132, RIND_0140, 
 RIND_0141, RIND_0150, RIND_0160, RIND_0170, RIND_0180, 
 RIND_0190, RIND_2000, RIND_3000, RIND_3010, RIND_3020, 
 RIND_5000, RIND_5010, RIND_5020, RIND_5040, RIND_7000, 
 RIND_8000, RIND_9000, RIND_1000, RIND_1010, RIND_1050, 
 RIND_1200)
AS 
select 
--D.PERIOADA,
D.CUIIO,
--D.CUIIO_VERS, --------------------------------------------------------------
--R.DENUMIRE, 
--D.CUATM CUATM,
max(D.CAEM2) CAEM2,
--C.FULL_CODE FULL_CODE,
SUM(CASE WHEN D.CAPITOL = 1 AND D.RIND IN '2000' THEN D.COL1 ELSE NULL END) AS CAP_1_R_2000_1,
SUM(CASE WHEN D.CAPITOL = 1 AND D.RIND IN '2000' THEN D.COL2 ELSE NULL END) AS CAP_1_R_2000_2,
SUM(CASE WHEN D.CAPITOL = 1 AND D.RIND IN '2300' THEN D.COL1 ELSE NULL END) AS CAP_1_R_2300_1,
SUM(CASE WHEN D.CAPITOL = 1 AND D.RIND IN '2300' THEN D.COL2 ELSE NULL END) AS CAP_1_R_2300_2,
SUM(CASE WHEN D.CAPITOL = 1 AND D.RIND IN '2400' THEN D.COL1 ELSE NULL END) AS CAP_1_R_2400_1,
SUM(CASE WHEN D.CAPITOL = 1 AND D.RIND IN '2400' THEN D.COL2 ELSE NULL END) AS CAP_1_R_2400_2,
SUM(CASE WHEN D.CAPITOL = 1 AND D.RIND IN '2500' THEN D.COL1 ELSE NULL END) AS CAP_1_R_2500_1,
SUM(CASE WHEN D.CAPITOL = 1 AND D.RIND IN '2500' THEN D.COL2 ELSE NULL END) AS CAP_1_R_2500_2,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0100' THEN D.COL1 ELSE NULL END) AS RIND_0100,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0101' THEN D.COL1 ELSE NULL END) AS RIND_0101,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0102' THEN D.COL1 ELSE NULL END) AS RIND_0102,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0103' THEN D.COL1 ELSE NULL END) AS RIND_0103,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0110' THEN D.COL1 ELSE NULL END) AS RIND_0110,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0120' THEN D.COL1 ELSE NULL END) AS RIND_0120,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0121' THEN D.COL1 ELSE NULL END) AS RIND_0121,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0122' THEN D.COL1 ELSE NULL END) AS RIND_0122,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0130' THEN D.COL1 ELSE NULL END) AS RIND_0130,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0131' THEN D.COL1 ELSE NULL END) AS RIND_0131,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0132' THEN D.COL1 ELSE NULL END) AS RIND_0132,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0140' THEN D.COL1 ELSE NULL END) AS RIND_0140,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0141' THEN D.COL1 ELSE NULL END) AS RIND_0141,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0150' THEN D.COL1 ELSE NULL END) AS RIND_0150,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0160' THEN D.COL1 ELSE NULL END) AS RIND_0160,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0170' THEN D.COL1 ELSE NULL END) AS RIND_0170,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0180' THEN D.COL1 ELSE NULL END) AS RIND_0180,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '0190' THEN D.COL1 ELSE NULL END) AS RIND_0190,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '2000' THEN D.COL1 ELSE NULL END) AS RIND_2000,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '3000' THEN D.COL1 ELSE NULL END) AS RIND_3000,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '3010' THEN D.COL1 ELSE NULL END) AS RIND_3010,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '3020' THEN D.COL1 ELSE NULL END) AS RIND_3020,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '5000' THEN D.COL1 ELSE NULL END) AS RIND_5000,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '5010' THEN D.COL1 ELSE NULL END) AS RIND_5010,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '5020' THEN D.COL1 ELSE NULL END) AS RIND_5020,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '5040' THEN D.COL1 ELSE NULL END) AS RIND_5040,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '7000' THEN D.COL1 ELSE NULL END) AS RIND_7000,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '8000' THEN D.COL1 ELSE NULL END) AS RIND_8000,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '9000' THEN D.COL1 ELSE NULL END) AS RIND_9000,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '1000' THEN D.COL1 ELSE NULL END) AS RIND_1000,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '1010' THEN D.COL1 ELSE NULL END) AS RIND_1010,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '1050' THEN D.COL1 ELSE NULL END) AS RIND_1050,
SUM(CASE WHEN D.CAPITOL = 2 AND D.RIND IN '1200' THEN D.COL1 ELSE NULL END) AS RIND_1200







    from CIS.VW_DATA_ALL D 
  --              INNER JOIN CIS.RENIM R ON R.CUIIO = D.CUIIO AND R.CUIIO_VERS = D.CUIIO_VERS
    --            INNER JOIN CIS.VW_CL_CUATM C ON C.CODUL = D.CUATM 

where 

D.FORM = 1

AND 

D.PERIOADA IN (1059,1058,1057,1056)
AND D.CAPITOL IN (2,1)
--AND D.CUIIO = 458963
--AND D.RIND IN ('0100')

GROUP by
--D.PERIOADA,
D.CUIIO
--D.CUIIO_VERS,
--R.DENUMIRE, 
--D.CUATM,
--D.CAEM2,
--C.FULL_CODE

--ORDER BY
--C.FULL_CODE,
--D.CUIIO
--D.CUIIO_VERS
;
