BEGIN
--NEW VERS--
INSERT INTO CIS2.TABLE_OUT 
(
  PERIOADA,
  FORM,
  FORM_VERS,
  ID_MDTABLE,
  COD_CUATM,
  NR_SECTIE,
  NUME_SECTIE,
  NR_SECTIE1,
  NUME_SECTIE1,
  NR_SECTIE2,
  NUME_SECTIE2,
  NR_ROW,
  ORDINE,
  DECIMAL_POS,
  NUME_ROW,  
 COL1, COL2, COL3,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11, COL12, COL13, COL14, COL15, COL16, COL17, COL18, COL19,
    COL20, COL21, COL22,COL23,COL24,COL25,COL26,COL27,COL28,COL29,COL30, COL31, COL32, COL33, COL34, COL35, COL36, COL37, COL38, COL39, COL40,
    COL41, COL42,COL43,COL44,COL45,COL46,COL47,COL48,COL49,COL50
)


SELECT 
 
:pPERIOADA AS PERIOADA,
:pFORM AS FORM,
:pFORM_VERS AS FORM_VERS,
:pID_MDTABLE AS ID_MDTABLE,
:pCOD_CUATM AS COD_CUATM,    
 '0' AS  NR_SECTIE,
 '0' AS  NUME_SECTIE,
'0' AS NR_SECTIE1,
'0' AS NUME_SECTIE1,
'0' AS NR_SECTIE2,
'0' AS NUME_SECTIE2, 
NR_ROW,
ROWNUM AS ORDINE,--||'~'||ORDINE
'22222222222222222222222222222222222222222222222222' AS DECIMAL_POS,

NUME_ROW,
ROUND(COL1,2) AS COL1, ROUND(COL2,2) AS COL2,ROUND(COL3,2) AS COL3, ROUND(COL4,2)  AS COL4, ROUND(COL5,2)  AS COL5, ROUND(COL6,2)  AS COL6,
ROUND(COL7,1) AS COL7, ROUND(COL8,2) AS COL8,ROUND(COL9,2) AS COL9, ROUND(COL10,2) AS COL10,ROUND(COL11,2) AS COL11,ROUND(COL12,2) AS COL12,
ROUND(COL13,2) AS COL13, ROUND(COL14,2) AS COL14, ROUND(COL15,2) AS COL15, ROUND(COL16,2) AS COL16, ROUND(COL17,2) AS COL17,ROUND(COL18,2) AS COL18,
ROUND(COL19,2) AS COL19, ROUND(COL20,2) AS COL20, ROUND(COL21,2) AS COL21, ROUND(COL22,2) AS COL22, ROUND(COL23,2) AS COL23,ROUND(COL24,2) AS COL24,
ROUND(COL25,2) AS COL25, ROUND(COL26,2) AS COL26, ROUND(COL27,2) AS COL27, ROUND(COL28,2) AS COL28, ROUND(COL29,2) AS COL29,ROUND(COL30,2) AS COL30, 
ROUND(COL31,2) AS COL31, ROUND(COL32,2) AS COL32, ROUND(COL33,2) AS COL33, ROUND(COL34,2) AS COL34, ROUND(COL35,2) AS COL35,ROUND(COL36,2) AS COL36, 
ROUND(COL37,2) AS COL37, ROUND(COL38,2) AS COL38, ROUND(COL39,2) AS COL39, ROUND(COL40,2) AS COL40, ROUND(COL41,2) AS COL41,ROUND(COL42,2) AS COL42,
ROUND(COL43,2) AS COL43, ROUND(COL44,2) AS COL44, ROUND(COL45,2) AS COL45, ROUND(COL46,2) AS COL46, ROUND(COL47,2) AS COL47,ROUND(COL48,2) AS COL48,
ROUND(COL49,2) AS COL49, ROUND(COL50,2) AS COL50
     FROM (
--SELECT 
--:pPERIOADA AS PERIOADA,
--:pFORM AS FORM,
--:pFORM_VERS AS FORM_VERS,
--:pID_MDTABLE AS ID_MDTABLE,
--:pCOD_CUATM AS COD_CUATM,    
--  NR_SECTIE,
--  NUME_SECTIE,
--'0' AS NR_SECTIE1,
--'0' AS NUME_SECTIE1,
--'0' AS NR_SECTIE2,
--'0' AS NUME_SECTIE2, 
--NR_ROW||'~'|| NR_SECTIE||COL1||'1' AS NR_ROW,
-- 1||ORDINE AS ORDINE,
--'22222222222222222222222222222222222222222222222222' AS DECIMAL_POS,
--NUME_ROW,
--COL1, COL2, COL3,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11, COL12, COL13, COL14, COL15, COL16, COL17, COL18, COL19,
--    COL20, COL21, COL22,COL23,COL24,COL25,COL26,COL27,COL28,COL29,COL30, COL31, COL32, COL33, COL34, COL35, COL36, COL37, COL38, COL39, COL40,
--    COL41, COL42,COL43,COL44,COL45,COL46,COL47,COL48,COL49,COL50
--FROM
--(
--SELECT 
--    NR_ROW AS NR_SECTIE ,         
--    NUME_ROW AS NUME_SECTIE,  
--    DENUMIRE AS NUME_ROW,
--    CODUL AS NR_ROW,    
--    ORDINE,
--    COL1, COL2, COL3,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11, COL12, COL13, COL14, COL15, COL16, COL17, COL18, COL19,
--    COL20, COL21, COL22,COL23,COL24,COL25,COL26,COL27,COL28,COL29,COL30, COL31, COL32, COL33, COL34, COL35, COL36, COL37, COL38, COL39, COL40,
--    COL41, COL42,COL43,COL44,COL45,COL46,COL47,COL48,COL49,COL50
--   
--   FROM(
--
--SELECT 
--   '05' AS NR_ROW,
--   'Total republica Moldova' AS NUME_ROW,
--   CC.FULL_CODE,
--   CASE WHEN  CC.CODUL like '%0000' THEN CC.DENUMIRE END AS DENUMIRE,   
--   CASE WHEN  Substr(CC.CODUL,1,1)||'0000' IS NOT NULL THEN Substr(CC.CODUL,1,1)||'0000' END AS codul, 
--   '05'||'~'||CC.FULL_CODE AS ORDINE,
--   
--   SUM(CASE WHEN DR.CAPITOL IN (100)  AND DR.RIND IN ('CD')  THEN  DR.COL1 ELSE 0 END)  AS COL1, 
--   SUM( CASE  WHEN DD.COL0 BETWEEN 0 AND 3  AND DR.CAPITOL IN (100)  AND DR.RIND IN ('CD')  THEN DR.COL1  END) AS COL2, 
--   SUM( CASE  WHEN DD.COL0 BETWEEN 3 AND 6  AND DR.CAPITOL IN (100)  AND DR.RIND IN ('CD')  THEN DR.COL1  END) AS COL3, 
--   SUM( CASE  WHEN DD.COL0 BETWEEN 6 AND 9  AND DR.CAPITOL IN (100)  AND DR.RIND IN ('CD')  THEN DR.COL1  END) AS COL4, 
--   SUM( CASE  WHEN DD.COL0 BETWEEN 9 AND 12  AND DR.CAPITOL IN (100)  AND DR.RIND IN ('CD')  THEN DR.COL1  END) AS COL5,
--   
--  -- SUM(CASE WHEN DR.RIND IN ('100') THEN  DR.COL1 END) AS COL6
--  --1480355.7   1480489.2
--   SUM(CASE WHEN DR.RIND IN ('100') THEN  DR.COL1 END) AS COL6,
--   SUM(CASE WHEN DR.RIND IN ('110') THEN  DR.COL1 END) AS COL7,
--   SUM(CASE WHEN DR.RIND IN ('111') THEN  DR.COL1 END) AS COL8,
--   SUM(CASE WHEN DR.RIND IN ('112') THEN  DR.COL1 END) AS COL9,
--   SUM(CASE WHEN DR.RIND IN ('120') THEN  DR.COL1 END) AS COL10,
--   SUM(CASE WHEN DR.RIND IN ('121') THEN  DR.COL1 END) AS COL11,
--   SUM(CASE WHEN DR.RIND IN ('122') THEN  DR.COL1 END) AS COL12,
--   SUM(CASE WHEN DR.RIND IN ('130') THEN  DR.COL1 END) AS COL13,
--   SUM(CASE WHEN DR.RIND IN ('140') THEN  DR.COL1 END) AS COL14,
--   SUM(CASE WHEN DR.RIND IN ('150') THEN  DR.COL1 END) AS COL15,
--   SUM(CASE WHEN DR.RIND IN ('151') THEN  DR.COL1 END) AS COL16,
--   SUM(CASE WHEN DR.RIND IN ('160') THEN  DR.COL1 END) AS COL17,
--   SUM(CASE WHEN DR.RIND IN ('170') THEN  DR.COL1 END) AS COL18,
--   SUM(CASE WHEN DR.RIND IN ('180') THEN  DR.COL1 END) AS COL19,
--   
--   SUM(CASE WHEN DR.RIND IN ('200') THEN  DR.COL1 END) AS COL20,
--   SUM(CASE WHEN DR.RIND IN ('210') THEN  DR.COL1 END) AS COL21,
--   SUM(CASE WHEN DR.RIND IN ('220') THEN  DR.COL1 END) AS COL22,
--   SUM(CASE WHEN DR.RIND IN ('221') THEN  DR.COL1 END) AS COL23,
--   SUM(CASE WHEN DR.RIND IN ('222') THEN  DR.COL1 END) AS COL24,
--   SUM(CASE WHEN DR.RIND IN ('240') THEN  DR.COL1 END) AS COL25,
--   SUM(CASE WHEN DR.RIND IN ('241') THEN  DR.COL1 END) AS COL26,
--   SUM(CASE WHEN DR.RIND IN ('242') THEN  DR.COL1 END) AS COL27,
--   SUM(CASE WHEN DR.RIND IN ('243') THEN  DR.COL1 END) AS COL28,
--   SUM(CASE WHEN DR.RIND IN ('260') THEN  DR.COL1 END) AS COL29,
--   SUM(CASE WHEN DR.RIND IN ('270') THEN  DR.COL1 END) AS COL30,
--   SUM(CASE WHEN DR.RIND IN ('280') THEN  DR.COL1 END) AS COL31,
--   SUM(CASE WHEN DR.RIND IN ('281') THEN  DR.COL1 END) AS COL32,
--   SUM(CASE WHEN DR.RIND IN ('282') THEN  DR.COL1 END) AS COL33,
--   SUM(CASE WHEN DR.RIND IN ('290') THEN  DR.COL1 END) AS COL34,
--   SUM(CASE WHEN DR.RIND IN ('2911') THEN  DR.COL1 END) AS COL35,
--   SUM(CASE WHEN DR.RIND IN ('2912') THEN  DR.COL1 END) AS COL36,
--   SUM(CASE WHEN DR.RIND IN ('292') THEN  DR.COL1 END) AS COL37,
--   SUM(CASE WHEN DR.RIND IN ('293') THEN  DR.COL1 END) AS COL38,
--   SUM(CASE WHEN DR.RIND IN ('2931') THEN  DR.COL1 END) AS COL39,
--   SUM(CASE WHEN DR.RIND IN ('291') THEN  DR.COL1 END) AS COL40,
--   SUM(CASE WHEN DR.RIND IN ('294') THEN  DR.COL1 END) AS COL41,
--   SUM(CASE WHEN DR.RIND IN ('2941') THEN  DR.COL1 END) AS COL42,
--   SUM(CASE WHEN DR.RIND IN ('2942') THEN  DR.COL1 END) AS COL43,
--   SUM(CASE WHEN DR.RIND IN ('2943') THEN  DR.COL1 END) AS COL44,
--   SUM(CASE WHEN DR.RIND IN ('2944') THEN  DR.COL1 END) AS COL45,
--   SUM(CASE WHEN DR.RIND IN ('295') THEN  DR.COL1 END) AS COL46,
--   SUM(CASE WHEN DR.RIND IN ('296') THEN  DR.COL1 END) AS COL47,
--   SUM(CASE WHEN DR.RIND IN ('2961') THEN  DR.COL1 END) AS COL48,
--   SUM(CASE WHEN DR.RIND IN ('2962') THEN  DR.COL1 END) AS COL49,
--   SUM(CASE WHEN DR.RIND IN ('297') THEN  DR.COL1 END) AS COL50
--                                                                                     
--                
--    FROM
--    
--    
--    CIS2.VW_DATA_ALL_COEF DR INNER JOIN
--    
--    (
---------------------------------------------------------------------------------     
--         SELECT 
--    DISTINCT D.CUIIO,D.CUIIO_VERS, D.CUATM,
-- MAX( CASE WHEN  D.RIND IN ('8') AND D.CAPITOL IN (1129) THEN D.COL31 END )  AS CAEM2_ACTUALIZAT,
-- MAX(SUBSTR(D.CAEM2,2,4))  AS CAEM2,
--    D.PERIOADA,D.FORM_VERS,D.FORM,CUATM_FULL,D.CFOJ,
--    SUM(CASE WHEN D.CAPITOL IN (1123) AND D.RIND IN ('I','II','III','IV','V','VI','VII','VIII','IX','X','XI','XII') THEN  D.COL1 ELSE 0 END)  AS COL0
----    SUM(CASE WHEN D.CAPITOL IN (1127) AND D.RIND IN ('400') THEN  D.COL4 ELSE 0 END)  AS COL4,
----    SUM(CASE WHEN D.CAPITOL IN (100) AND D.RIND IN ('CD') THEN  D.COL1 ELSE 0 END)  AS CD 
--FROM   
--    CIS2.VW_DATA_ALL D       
--WHERE
--  D.FORM IN (64)             AND 
--  D.FORM_VERS = :PFORM_VERS  AND      
--  D.PERIOADA =:pPERIOADA AND
--  D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%'   AND
--  D.CAPITOL IN (100,1123,1129) 
--  AND D.RIND IN ('I','II','III','IV','V','VI','VII','VIII','IX','X','XI','XII','400','CD','8')
---- AND  D.CUIIO=40075114
-- GROUP BY D.CUIIO,D.CUIIO_VERS, D.CUATM,D.PERIOADA,D.FORM_VERS,D.FORM,CUATM_FULL,D.CFOJ
-- 
-- HAVING 
-- SUM(CASE WHEN D.CAPITOL IN (100) AND D.RIND IN ('CD') THEN  D.COL1 ELSE 0 END)>0
--
--) DD ON DR.CUIIO=DD.CUIIO AND DR.CUIIO_VERS=DD.CUIIO_VERS
--
-- INNER JOIN CIS2.VW_CL_CAEM2 C ON SUBSTR(C.CODUL,2,4)  = CASE WHEN DD.CAEM2_ACTUALIZAT IS NULL THEN DD.CAEM2 ELSE DD.CAEM2_ACTUALIZAT END                 
-- INNER JOIN CIS2.VW_CL_CAEM2 CC ON (C.FULL_CODE LIKE '%'||CC.CODUL||';%')
-- 
----  CROSS JOIN
----  ( 
----     SELECT 'Total republica Moldova'     AS NUME_ROW, '05' AS NR_ROW, 0 AS PERS_FROM, 99999999 AS PERS_TO FROM DUAL       
----    
----  ) RR  
--         
-- WHERE 
--  (DR.FORM=:pFORM) AND
--  (DR.FORM_VERS=:pFORM_VERS) AND
--  (:pID_MDTABLE=:pID_MDTABLE) AND
--  (DR.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%') AND   
--  DR.PERIOADA IN (:pPERIOADA) 
-- -- AND  C.CODUL LIKE '%00'
-- AND DR.FORM IN (64)
-- AND DR.CAPITOL IN (100,1124,1125,1129)
-- 
--   GROUP BY
--    CC.FULL_CODE,
--   CC.DENUMIRE,
--    CC.CODUL
----    RR.NR_ROW,       
----    RR.NUME_ROW
--     
--    ORDER BY 
----     RR.NR_ROW,
--     CC.CODUL)
--     
--     WHERE DENUMIRE IS NOT NULL)
--     
--     
--     UNION
     
     
     SELECT 
:pPERIOADA AS PERIOADA,
:pFORM AS FORM,
:pFORM_VERS AS FORM_VERS,
:pID_MDTABLE AS ID_MDTABLE,
:pCOD_CUATM AS COD_CUATM,    
  NR_SECTIE,
  NUME_SECTIE,
'0' AS NR_SECTIE1,
'0' AS NUME_SECTIE1,
'0' AS NR_SECTIE2,
'0' AS NUME_SECTIE2, 
NR_ROW||'~'|| NR_SECTIE||COL1||'2' AS NR_ROW,
2||ORDINE AS ORDINE,
'22222222222222222222222222222222222222222222222222' AS DECIMAL_POS,
NUME_ROW,
ROUND(COL1,2) AS COL1, ROUND(COL2,2) AS COL2,ROUND(COL3,2) AS COL3, ROUND(COL4,2)  AS COL4, ROUND(COL5,2)  AS COL5, ROUND(COL6,2)  AS COL6,
ROUND(COL7,1) AS COL7, ROUND(COL8,2) AS COL8,ROUND(COL9,2) AS COL9, ROUND(COL10,2) AS COL10,ROUND(COL11,2) AS COL11,ROUND(COL12,2) AS COL12,
ROUND(COL13,2) AS COL13, ROUND(COL14,2) AS COL14, ROUND(COL15,2) AS COL15, ROUND(COL16,2) AS COL16, ROUND(COL17,2) AS COL17,ROUND(COL18,2) AS COL18,
ROUND(COL19,2) AS COL19, ROUND(COL20,2) AS COL20, ROUND(COL21,2) AS COL21, ROUND(COL22,2) AS COL22, ROUND(COL23,2) AS COL23,ROUND(COL24,2) AS COL24,
ROUND(COL25,2) AS COL25, ROUND(COL26,2) AS COL26, ROUND(COL27,2) AS COL27, ROUND(COL28,2) AS COL28, ROUND(COL29,2) AS COL29,ROUND(COL30,2) AS COL30, 
ROUND(COL31,2) AS COL31, ROUND(COL32,2) AS COL32, ROUND(COL33,2) AS COL33, ROUND(COL34,2) AS COL34, ROUND(COL35,2) AS COL35,ROUND(COL36,2) AS COL36, 
ROUND(COL37,2) AS COL37, ROUND(COL38,2) AS COL38, ROUND(COL39,2) AS COL39, ROUND(COL40,2) AS COL40, ROUND(COL41,2) AS COL41,ROUND(COL42,2) AS COL42,
ROUND(COL43,2) AS COL43, ROUND(COL44,2) AS COL44, ROUND(COL45,2) AS COL45, ROUND(COL46,2) AS COL46, ROUND(COL47,2) AS COL47,ROUND(COL48,2) AS COL48,
ROUND(COL49,2) AS COL49, ROUND(COL50,2) AS COL50
FROM
(
 SELECT
D.NR_ROW AS NR_SECTIE,         
D.NUME_ROW AS NUME_SECTIE,
D.CODUL AS NR_ROW,
ORDINE,
D.DENUMIRE AS NUME_ROW,
COL1, COL2, COL3,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11, COL12, COL13, COL14, COL15, COL16, COL17, COL18, COL19,
    COL20, COL21, COL22,COL23,COL24,COL25,COL26,COL27,COL28,COL29,COL30, COL31, COL32, COL33, COL34, COL35, COL36, COL37, COL38, COL39, COL40,
    COL41, COL42,COL43,COL44,COL45,COL46,COL47,COL48,COL49,COL50

FROM(
SELECT 
   '05' AS NR_ROW,
   'Total republica Moldova' AS NUME_ROW,
   CC.FULL_CODE,
   CC.DENUMIRE,
   CC.CODUL,
   '05'||'~'||CC.FULL_CODE AS ORDINE,
   
   SUM(CASE WHEN DR.CAPITOL IN (100)  AND DR.RIND IN ('CD')  THEN  DR.COL1 ELSE 0 END)  AS COL1, 
   SUM( CASE  WHEN DD.COL0 BETWEEN 0 AND 3  AND DR.CAPITOL IN (100)  AND DR.RIND IN ('CD')  THEN DR.COL1  END) AS COL2, 
   SUM( CASE  WHEN DD.COL0 BETWEEN 3 AND 6  AND DR.CAPITOL IN (100)  AND DR.RIND IN ('CD')  THEN DR.COL1  END) AS COL3, 
   SUM( CASE  WHEN DD.COL0 BETWEEN 6 AND 9  AND DR.CAPITOL IN (100)  AND DR.RIND IN ('CD')  THEN DR.COL1  END) AS COL4, 
   SUM( CASE  WHEN DD.COL0 BETWEEN 9 AND 12  AND DR.CAPITOL IN (100)  AND DR.RIND IN ('CD')  THEN DR.COL1  END) AS COL5,
  
   SUM(CASE WHEN DR.RIND IN ('100') THEN  DR.COL1 END) AS COL6,
   SUM(CASE WHEN DR.RIND IN ('110') THEN  DR.COL1 END) AS COL7,
   SUM(CASE WHEN DR.RIND IN ('111') THEN  DR.COL1 END) AS COL8,
   SUM(CASE WHEN DR.RIND IN ('112') THEN  DR.COL1 END) AS COL9,
   SUM(CASE WHEN DR.RIND IN ('120') THEN  DR.COL1 END) AS COL10,
   SUM(CASE WHEN DR.RIND IN ('121') THEN  DR.COL1 END) AS COL11,
   SUM(CASE WHEN DR.RIND IN ('122') THEN  DR.COL1 END) AS COL12,
   SUM(CASE WHEN DR.RIND IN ('130') THEN  DR.COL1 END) AS COL13,
   SUM(CASE WHEN DR.RIND IN ('140') THEN  DR.COL1 END) AS COL14,
   SUM(CASE WHEN DR.RIND IN ('150') THEN  DR.COL1 END) AS COL15,
   SUM(CASE WHEN DR.RIND IN ('151') THEN  DR.COL1 END) AS COL16,
   SUM(CASE WHEN DR.RIND IN ('160') THEN  DR.COL1 END) AS COL17,
   SUM(CASE WHEN DR.RIND IN ('170') THEN  DR.COL1 END) AS COL18,
   SUM(CASE WHEN DR.RIND IN ('180') THEN  DR.COL1 END) AS COL19,
   
   SUM(CASE WHEN DR.RIND IN ('200') THEN  DR.COL1 END) AS COL20,
   SUM(CASE WHEN DR.RIND IN ('210') THEN  DR.COL1 END) AS COL21,
   SUM(CASE WHEN DR.RIND IN ('220') THEN  DR.COL1 END) AS COL22,
   SUM(CASE WHEN DR.RIND IN ('221') THEN  DR.COL1 END) AS COL23,
   SUM(CASE WHEN DR.RIND IN ('222') THEN  DR.COL1 END) AS COL24,
   SUM(CASE WHEN DR.RIND IN ('240') THEN  DR.COL1 END) AS COL25,
   SUM(CASE WHEN DR.RIND IN ('241') THEN  DR.COL1 END) AS COL26,
   SUM(CASE WHEN DR.RIND IN ('242') THEN  DR.COL1 END) AS COL27,
   SUM(CASE WHEN DR.RIND IN ('243') THEN  DR.COL1 END) AS COL28,
   SUM(CASE WHEN DR.RIND IN ('260') THEN  DR.COL1 END) AS COL29,
   SUM(CASE WHEN DR.RIND IN ('270') THEN  DR.COL1 END) AS COL30,
   SUM(CASE WHEN DR.RIND IN ('280') THEN  DR.COL1 END) AS COL31,
   SUM(CASE WHEN DR.RIND IN ('281') THEN  DR.COL1 END) AS COL32,
   SUM(CASE WHEN DR.RIND IN ('282') THEN  DR.COL1 END) AS COL33,
   SUM(CASE WHEN DR.RIND IN ('290') THEN  DR.COL1 END) AS COL34,
   SUM(CASE WHEN DR.RIND IN ('2911') THEN  DR.COL1 END) AS COL35,
   SUM(CASE WHEN DR.RIND IN ('2912') THEN  DR.COL1 END) AS COL36,
   SUM(CASE WHEN DR.RIND IN ('292') THEN  DR.COL1 END) AS COL37,
   SUM(CASE WHEN DR.RIND IN ('293') THEN  DR.COL1 END) AS COL38,
   SUM(CASE WHEN DR.RIND IN ('2931') THEN  DR.COL1 END) AS COL39,
   SUM(CASE WHEN DR.RIND IN ('291') THEN  DR.COL1 END) AS COL40,
   SUM(CASE WHEN DR.RIND IN ('294') THEN  DR.COL1 END) AS COL41,
   SUM(CASE WHEN DR.RIND IN ('2941') THEN  DR.COL1 END) AS COL42,
   SUM(CASE WHEN DR.RIND IN ('2942') THEN  DR.COL1 END) AS COL43,
   SUM(CASE WHEN DR.RIND IN ('2943') THEN  DR.COL1 END) AS COL44,
   SUM(CASE WHEN DR.RIND IN ('2944') THEN  DR.COL1 END) AS COL45,
   SUM(CASE WHEN DR.RIND IN ('295') THEN  DR.COL1 END) AS COL46,
   SUM(CASE WHEN DR.RIND IN ('296') THEN  DR.COL1 END) AS COL47,
   SUM(CASE WHEN DR.RIND IN ('2961') THEN  DR.COL1 END) AS COL48,
   SUM(CASE WHEN DR.RIND IN ('2962') THEN  DR.COL1 END) AS COL49,
   SUM(CASE WHEN DR.RIND IN ('297') THEN  DR.COL1 END) AS COL50
                                                                                     
                
    FROM
    
    
    CIS2.VW_DATA_ALL_COEF DR INNER JOIN
    
    (
-------------------------------------------------------------------------------     
         SELECT 
    DISTINCT D.CUIIO,D.CUIIO_VERS, D.CUATM,
 MAX( CASE WHEN  D.RIND IN ('8') AND D.CAPITOL IN (1129) THEN D.COL31 END )  AS CAEM2_ACTUALIZAT,
 MAX(SUBSTR(D.CAEM2,2,4))  AS CAEM2,
    D.PERIOADA,D.FORM_VERS,D.FORM,CUATM_FULL,D.CFOJ,
    SUM(CASE WHEN D.CAPITOL IN (1123) AND D.RIND IN ('I','II','III','IV','V','VI','VII','VIII','IX','X','XI','XII') THEN  D.COL1 ELSE 0 END)  AS COL0
--    SUM(CASE WHEN D.CAPITOL IN (1127) AND D.RIND IN ('400') THEN  D.COL4 ELSE 0 END)  AS COL4,
--    SUM(CASE WHEN D.CAPITOL IN (100) AND D.RIND IN ('CD') THEN  D.COL1 ELSE 0 END)  AS CD 
FROM   
    CIS2.VW_DATA_ALL D       
WHERE
  D.FORM IN (64)             AND 
  D.FORM_VERS = :PFORM_VERS  AND      
  D.PERIOADA =:pPERIOADA AND
  D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%'   AND
  D.CAPITOL IN (100,1123,1129) 
  AND D.RIND IN ('I','II','III','IV','V','VI','VII','VIII','IX','X','XI','XII','400','CD','8')
-- AND  D.CUIIO=40075114
 GROUP BY D.CUIIO,D.CUIIO_VERS, D.CUATM,D.PERIOADA,D.FORM_VERS,D.FORM,CUATM_FULL,D.CFOJ
 
 HAVING 
 SUM(CASE WHEN D.CAPITOL IN (100) AND D.RIND IN ('CD') THEN  D.COL1 ELSE 0 END)>0

) DD ON DR.CUIIO=DD.CUIIO AND DR.CUIIO_VERS=DD.CUIIO_VERS
-------------------------------------------------------------------------------    

 INNER JOIN CIS2.VW_CL_CAEM2 C ON SUBSTR( C.CODUL,2,4)  = CASE WHEN DD.CAEM2_ACTUALIZAT IS NULL THEN DD.CAEM2 ELSE DD.CAEM2_ACTUALIZAT END                   
 INNER JOIN CIS2.VW_CL_CAEM2 CC ON (C.FULL_CODE LIKE '%'||CC.CODUL||';%')
 
--  CROSS JOIN
--  ( 
--    SELECT 'Total republica Moldova'  AS NUME_ROW, '05' AS NR_ROW, 0 AS PERS_FROM, 99999999 AS PERS_TO FROM DUAL       
--    
--  ) RR  
         
 WHERE 
  (DR.FORM=:pFORM) AND
  (DR.FORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  (DR.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%') AND   
  DR.PERIOADA IN (:pPERIOADA) 
 -- AND  C.CODUL LIKE '%0'
 AND DR.FORM IN (64)
 AND DR.CAPITOL IN (100,1124,1125,1129)
 
   GROUP BY
    CC.FULL_CODE,
    CC.DENUMIRE,
    CC.CODUL
--    RR.NR_ROW,       
--    RR.NUME_ROW
    
    ORDER BY 
--     RR.NR_ROW,
     CC.CODUL
     ) D
     
--      WHERE
--         
--          NVAL(D.COL1)+ NVAL(D.COL2)+ NVAL(D.COL3)+NVAL(D.COL4)+NVAL(D.COL5)>0
          )
     ORDER BY ORDINE ) ORDER BY ORDINE;
     END;