
WITH COLUMN_MAPPING AS (
    SELECT 
        CASE RR.NR_ROW
            WHEN '10' THEN DD.Col1 WHEN '20' THEN DD.Col2 WHEN '30' THEN DD.Col3 WHEN '40' THEN DD.Col4 WHEN '50' THEN DD.Col5 WHEN '60' THEN DD.Col6 WHEN '70' THEN DD.Col7 WHEN '80' THEN DD.Col8 WHEN '90' THEN DD.Col9 WHEN '100' THEN DD.Col10 WHEN '110' THEN DD.Col11 WHEN '120' THEN DD.Col12 WHEN '130' THEN DD.Col13 WHEN '140' THEN DD.Col14 WHEN '150' THEN DD.Col15 WHEN '160' THEN DD.Col16 WHEN '170' THEN DD.Col17 WHEN '180' THEN DD.Col18 WHEN '190' THEN DD.Col19 WHEN '200' THEN DD.Col20 WHEN '210' THEN DD.Col21 WHEN '220' THEN DD.Col22 WHEN '230' THEN DD.Col23 WHEN '240' THEN DD.Col24 WHEN '250' THEN DD.Col25 WHEN '260' THEN DD.Col26 WHEN '270' THEN DD.Col27 WHEN '280' THEN DD.Col28 WHEN '290' THEN DD.Col29 WHEN '300' THEN DD.Col30 WHEN '310' THEN DD.Col31 WHEN '320' THEN DD.Col32 WHEN '330' THEN DD.Col33 WHEN '340' THEN DD.Col34 WHEN '350' THEN DD.Col35 WHEN '360' THEN DD.Col36 WHEN '370' THEN DD.Col37 WHEN '380' THEN DD.Col38 WHEN '390' THEN DD.Col39 WHEN '400' THEN DD.Col40 WHEN '410' THEN DD.Col41 WHEN '420' THEN DD.Col42 WHEN '430' THEN DD.Col43 WHEN '440' THEN DD.Col44 WHEN '450' THEN DD.Col45 WHEN '460' THEN DD.Col46 WHEN '470' THEN DD.Col47 WHEN '480' THEN DD.Col48 WHEN '490' THEN DD.Col49 WHEN '500' THEN DD.Col50 WHEN '510' THEN DD.Col51 WHEN '520' THEN DD.Col52 WHEN '530' THEN DD.Col53 WHEN '540' THEN DD.Col54 WHEN '550' THEN DD.Col55 WHEN '560' THEN DD.Col56 WHEN '570' THEN DD.Col57 WHEN '580' THEN DD.Col58 WHEN '590' THEN DD.Col59 WHEN '600' THEN DD.Col60
            ELSE NULL
        END AS COLUMN_VALUE,
        RR.NR_ROW
    FROM DUAL
),
MAIN_QUERY AS (
    SELECT DISTINCT D.CUIIO, 
        CASE WHEN MAX(CASE WHEN D.RIND IN ('8') AND D.CAPITOL IN (1129) THEN D.COL31 END) IS NULL 
            THEN MAX(SUBSTR(D.CAEM2,2,4)) 
            ELSE MAX(CASE WHEN D.RIND IN ('8') AND D.CAPITOL IN (1129) THEN D.COL31 END) 
        END AS CAEM2_ACTUALIZAT,
        MAX(SUBSTR(D.CAEM2,2,4))  AS CAEM2,
        D.CUIIO_VERS, 
        D.CUATM, D.FORM, D.FORM_VERS, D.CUATM_FULL, D.PERIOADA,
        CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('10') THEN CIS2.NVAL(D.COL1) END)) AS Col1, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('20') THEN CIS2.NVAL(D.COL1) END)) AS Col2, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('30') THEN CIS2.NVAL(D.COL1) END)) AS Col3, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('40') THEN CIS2.NVAL(D.COL1) END)) AS Col4, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('50') THEN CIS2.NVAL(D.COL1) END)) AS Col5, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('60') THEN CIS2.NVAL(D.COL1) END)) AS Col6, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('70') THEN CIS2.NVAL(D.COL1) END)) AS Col7, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('80') THEN CIS2.NVAL(D.COL1) END)) AS Col8, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('90') THEN CIS2.NVAL(D.COL1) END)) AS Col9, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('100') THEN CIS2.NVAL(D.COL1) END)) AS Col10, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('110') THEN CIS2.NVAL(D.COL1) END)) AS Col11, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('120') THEN CIS2.NVAL(D.COL1) END)) AS Col12, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('130') THEN CIS2.NVAL(D.COL1) END)) AS Col13, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('140') THEN CIS2.NVAL(D.COL1) END)) AS Col14, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('150') THEN CIS2.NVAL(D.COL1) END)) AS Col15, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('160') THEN CIS2.NVAL(D.COL1) END)) AS Col16, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('170') THEN CIS2.NVAL(D.COL1) END)) AS Col17, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('180') THEN CIS2.NVAL(D.COL1) END)) AS Col18, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('190') THEN CIS2.NVAL(D.COL1) END)) AS Col19, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('200') THEN CIS2.NVAL(D.COL1) END)) AS Col20, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('210') THEN CIS2.NVAL(D.COL1) END)) AS Col21, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('220') THEN CIS2.NVAL(D.COL1) END)) AS Col22, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('230') THEN CIS2.NVAL(D.COL1) END)) AS Col23, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('240') THEN CIS2.NVAL(D.COL1) END)) AS Col24, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('250') THEN CIS2.NVAL(D.COL1) END)) AS Col25, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('260') THEN CIS2.NVAL(D.COL1) END)) AS Col26, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('270') THEN CIS2.NVAL(D.COL1) END)) AS Col27, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('280') THEN CIS2.NVAL(D.COL1) END)) AS Col28, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('290') THEN CIS2.NVAL(D.COL1) END)) AS Col29, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('300') THEN CIS2.NVAL(D.COL1) END)) AS Col30, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('310') THEN CIS2.NVAL(D.COL1) END)) AS Col31, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('320') THEN CIS2.NVAL(D.COL1) END)) AS Col32, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('330') THEN CIS2.NVAL(D.COL1) END)) AS Col33, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('340') THEN CIS2.NVAL(D.COL1) END)) AS Col34, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('350') THEN CIS2.NVAL(D.COL1) END)) AS Col35, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('360') THEN CIS2.NVAL(D.COL1) END)) AS Col36, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('370') THEN CIS2.NVAL(D.COL1) END)) AS Col37, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('380') THEN CIS2.NVAL(D.COL1) END)) AS Col38, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('390') THEN CIS2.NVAL(D.COL1) END)) AS Col39, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('400') THEN CIS2.NVAL(D.COL1) END)) AS Col40, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('410') THEN CIS2.NVAL(D.COL1) END)) AS Col41, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('420') THEN CIS2.NVAL(D.COL1) END)) AS Col42, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('430') THEN CIS2.NVAL(D.COL1) END)) AS Col43, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('440') THEN CIS2.NVAL(D.COL1) END)) AS Col44, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('450') THEN CIS2.NVAL(D.COL1) END)) AS Col45, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('460') THEN CIS2.NVAL(D.COL1) END)) AS Col46, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('470') THEN CIS2.NVAL(D.COL1) END)) AS Col47, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('480') THEN CIS2.NVAL(D.COL1) END)) AS Col48, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('490') THEN CIS2.NVAL(D.COL1) END)) AS Col49, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('500') THEN CIS2.NVAL(D.COL1) END)) AS Col50, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('510') THEN CIS2.NVAL(D.COL1) END)) AS Col51, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('520') THEN CIS2.NVAL(D.COL1) END)) AS Col52, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('530') THEN CIS2.NVAL(D.COL1) END)) AS Col53, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('540') THEN CIS2.NVAL(D.COL1) END)) AS Col54, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('550') THEN CIS2.NVAL(D.COL1) END)) AS Col55, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('560') THEN CIS2.NVAL(D.COL1) END)) AS Col56, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('570') THEN CIS2.NVAL(D.COL1) END)) AS Col57, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('580') THEN CIS2.NVAL(D.COL1) END)) AS Col58, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('590') THEN CIS2.NVAL(D.COL1) END)) AS Col59, CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1124) AND D.RIND IN ('600') THEN CIS2.NVAL(D.COL1) END)) AS Col60
    FROM CIS2.VW_DATA_ALL_COEF D       
    WHERE
        D.FORM IN (64) AND 
        D.FORM_VERS = :PFORM_VERS AND      
        D.PERIOADA = :pPERIOADA AND
        D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%' AND
        D.CAPITOL IN (100,1123,1124,1125,1126,1127,1128,1129) 
        AND D.CUIIO IN (26844)
    GROUP BY D.CUIIO, D.CUIIO_VERS, D.CUATM, D.FORM, D.FORM_VERS, D.CUATM_FULL, D.PERIOADA
)
SELECT 
    RR.NR_ROW,
    ROUND(SUM(COLUMN_MAPPING.COLUMN_VALUE), 1) AS COL1
FROM COLUMN_MAPPING
CROSS JOIN (
    SELECT '10' AS NR_ROW, 'Col1' AS COL FROM DUAL UNION SELECT '20' AS NR_ROW, 'Col2' AS COL FROM DUAL UNION SELECT '30' AS NR_ROW, 'Col3' AS COL FROM DUAL UNION SELECT '40' AS NR_ROW, 'Col4' AS COL FROM DUAL UNION SELECT '50' AS NR_ROW, 'Col5' AS COL FROM DUAL UNION SELECT '60' AS NR_ROW, 'Col6' AS COL FROM DUAL UNION SELECT '70' AS NR_ROW, 'Col7' AS COL FROM DUAL UNION SELECT '80' AS NR_ROW, 'Col8' AS COL FROM DUAL UNION SELECT '90' AS NR_ROW, 'Col9' AS COL FROM DUAL UNION SELECT '100' AS NR_ROW, 'Col10' AS COL FROM DUAL UNION SELECT '110' AS NR_ROW, 'Col11' AS COL FROM DUAL UNION SELECT '120' AS NR_ROW, 'Col12' AS COL FROM DUAL UNION SELECT '130' AS NR_ROW, 'Col13' AS COL FROM DUAL UNION SELECT '140' AS NR_ROW, 'Col14' AS COL FROM DUAL UNION SELECT '150' AS NR_ROW, 'Col15' AS COL FROM DUAL UNION SELECT '160' AS NR_ROW, 'Col16' AS COL FROM DUAL UNION SELECT '170' AS NR_ROW, 'Col17' AS COL FROM DUAL UNION SELECT '180' AS NR_ROW, 'Col18' AS COL FROM DUAL UNION SELECT '190' AS NR_ROW, 'Col19' AS COL FROM DUAL UNION SELECT '200' AS NR_ROW, 'Col20' AS COL FROM DUAL UNION SELECT '210' AS NR_ROW, 'Col21' AS COL FROM DUAL UNION SELECT '220' AS NR_ROW, 'Col22' AS COL FROM DUAL UNION SELECT '230' AS NR_ROW, 'Col23' AS COL FROM DUAL UNION SELECT '240' AS NR_ROW, 'Col24' AS COL FROM DUAL UNION SELECT '250' AS NR_ROW, 'Col25' AS COL FROM DUAL UNION SELECT '260' AS NR_ROW, 'Col26' AS COL FROM DUAL UNION SELECT '270' AS NR_ROW, 'Col27' AS COL FROM DUAL UNION SELECT '280' AS NR_ROW, 'Col28' AS COL FROM DUAL UNION SELECT '290' AS NR_ROW, 'Col29' AS COL FROM DUAL UNION SELECT '300' AS NR_ROW, 'Col30' AS COL FROM DUAL UNION SELECT '310' AS NR_ROW, 'Col31' AS COL FROM DUAL UNION SELECT '320' AS NR_ROW, 'Col32' AS COL FROM DUAL UNION SELECT '330' AS NR_ROW, 'Col33' AS COL FROM DUAL UNION SELECT '340' AS NR_ROW, 'Col34' AS COL FROM DUAL UNION SELECT '350' AS NR_ROW, 'Col35' AS COL FROM DUAL UNION SELECT '360' AS NR_ROW, 'Col36' AS COL FROM DUAL UNION SELECT '370' AS NR_ROW, 'Col37' AS COL FROM DUAL UNION SELECT '380' AS NR_ROW, 'Col38' AS COL FROM DUAL UNION SELECT '390' AS NR_ROW, 'Col39' AS COL FROM DUAL UNION SELECT '400' AS NR_ROW, 'Col40' AS COL FROM DUAL UNION SELECT '410' AS NR_ROW, 'Col41' AS COL FROM DUAL UNION SELECT '420' AS NR_ROW, 'Col42' AS COL FROM DUAL UNION SELECT '430' AS NR_ROW, 'Col43' AS COL FROM DUAL UNION SELECT '440' AS NR_ROW, 'Col44' AS COL FROM DUAL UNION SELECT '450' AS NR_ROW, 'Col45' AS COL FROM DUAL UNION SELECT '460' AS NR_ROW, 'Col46' AS COL FROM DUAL UNION SELECT '470' AS NR_ROW, 'Col47' AS COL FROM DUAL UNION SELECT '480' AS NR_ROW, 'Col48' AS COL FROM DUAL UNION SELECT '490' AS NR_ROW, 'Col49' AS COL FROM DUAL UNION SELECT '500' AS NR_ROW, 'Col50' AS COL FROM DUAL UNION SELECT '510' AS NR_ROW, 'Col51' AS COL FROM DUAL UNION SELECT '520' AS NR_ROW, 'Col52' AS COL FROM DUAL UNION SELECT '530' AS NR_ROW, 'Col53' AS COL FROM DUAL UNION SELECT '540' AS NR_ROW, 'Col54' AS COL FROM DUAL UNION SELECT '550' AS NR_ROW, 'Col55' AS COL FROM DUAL UNION SELECT '560' AS NR_ROW, 'Col56' AS COL FROM DUAL UNION SELECT '570' AS NR_ROW, 'Col57' AS COL FROM DUAL UNION SELECT '580' AS NR_ROW, 'Col58' AS COL FROM DUAL UNION SELECT '590' AS NR_ROW, 'Col59' AS COL FROM DUAL UNION SELECT '600' AS NR_ROW, 'Col60' AS COL FROM DUAL
) RR
WHERE 
    (DD.FORM = :pFORM) AND
    (DD.FORM_VERS = :pFORM_VERS) AND
    (:pID_MDTABLE = :pID_MDTABLE) AND
    (DD.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%') AND   
    DD.PERIOADA IN (:pPERIOADA) AND
    DD.CUIIO = 26844
GROUP BY
    RR.NR_ROW
ORDER BY 
    RR.NR_ROW;
