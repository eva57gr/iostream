SELECT 
B.NR_ROW,
B.NUME_ROW,
COUNT(CASE WHEN B.NR_ROW1 LIKE '%'||C.CODUL||'%' THEN DD.CUIIO   END) AS COL2

FROM
   (
SELECT 
 
 DISTINCT D.CUIIO, 
CASE WHEN MAX(CASE WHEN  D.RIND IN ('8') AND D.CAPITOL IN (1129) THEN D.COL31 END ) IS NULL 
 THEN    MAX(SUBSTR(D.CAEM2,2,4))  ELSE MAX(CASE WHEN  D.RIND IN ('8') AND D.CAPITOL IN (1129) THEN D.COL31 END ) END 
  AS CAEM2_ACTUALIZAT,
--
 MAX(SUBSTR(D.CAEM2,2,4))  AS CAEM2
 
 
 
FROM   
    CIS2.VW_DATA_ALL D       
WHERE
  D.FORM IN (64)             AND 
  D.FORM_VERS = :PFORM_VERS  AND      
  D.PERIOADA =:pPERIOADA AND
 -- D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%'   AND
 D.CAPITOL IN (100,1123,1124,1125,1126,1127,1128,1129) 
  
AND  D.CUIIO=40856685
 GROUP BY 
 D.CUIIO
 
 ) DD
 
  
  INNER JOIN CIS2.VW_CL_CAEM2 C ON  --SUBSTR( C.CODUL,2,4)  = DD.CAEM2_ACTUALIZAT
                                    SUBSTR( C.CODUL,2,4) = DD.CAEM2
                                    
 CROSS JOIN
(

SELECT 'C1000+C1000+C1100+C1200+C1300+C1400+C1500+C1600+C1700+C1800+C1900+C2000+C2100+C2200+C2300+C2400+C2500+C2600+C2700+C2800+C2900+C3000+C3100+C3200+C3300' AS NR_ROW1, 'C0000' AS NR_ROW,   'INDUSTRIA PRELUCRATOARE' AS NUME_ROW, 1 AS ORDINE FROM DUAL UNION
SELECT 'C1000+C1020'    AS NR_ROW1, 'C1000'    AS NR_ROW, 'Fabricarea bauturilor'      AS NUME_ROW, 2 AS ORDINE FROM DUAL UNION 
SELECT 'C1010+C1011+C1011+C1013'    AS NR_ROW1, 'C1200'    AS NR_ROW, 'Productia, prelucrarea si conservarea carnii si a produselor din carne'      AS NUME_ROW, 2 AS ORDINE FROM DUAL 

) B                                   
                                    
                                      
   
   GROUP BY
B.NR_ROW,
B.NUME_ROW
   
   
   ORDER BY 
B.NR_ROW,
B.NUME_ROW
