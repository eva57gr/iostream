SELECT   


  ROUND((SUM(CASE WHEN D.CAPITOL IN (1002)  AND  D.RIND IN ('010') AND D.PERIOADA IN (:PERIOADA)     THEN (D.COL1) ELSE 0 END) / 
  NOZERO(SUM(CASE WHEN D.CAPITOL IN (1002)  AND  D.RIND IN ('010') AND D.PERIOADA IN (:PERIOADA - 1) THEN (D.COL1) ELSE 0 END ))  )   * 100,0)
 
 AS REZULTAT

FROM VW_DATA_ALL D
  
 
WHERE
  (D.PERIOADA IN (:PERIOADA,:PERIOADA-1)      ) AND
  (D.CUIIO=:CUIIO               OR :CUIIO = -1) AND
  (:CUIIO_VERS=:CUIIO_VERS      OR :CUIIO_VERS <>  :CUIIO_VERS) AND
  (D.FORM = :FORM               OR :FORM = -1) AND
  (D.FORM_VERS=:FORM_VERS  OR :FORM_VERS = -1) AND
  (D.CAPITOL=:CAPITOL           OR :CAPITOL = -1) AND
  (D.CAPITOL_VERS = :CAPITOL_VERS OR  :CAPITOL_VERS = -1) AND
  (:ID_MD=:ID_MD               OR :ID_MD <>  :ID_MD  ) AND
  
  D.FORM IN (17)   AND  D.CAPITOL IN (1002) 
  AND D.RIND IN ('010')
 

HAVING 


   ROUND((SUM(CASE WHEN D.CAPITOL IN (1002)  AND  D.RIND IN ('010') AND D.PERIOADA IN (:PERIOADA)     THEN (D.COL1) ELSE 0 END) / 
  SUM(CASE WHEN D.CAPITOL IN (1002)  AND  D.RIND IN ('010') AND D.PERIOADA IN (:PERIOADA - 1) THEN (D.COL1) ELSE 0 END )  )   * 100,0) <> 15 
  
  




