--INSERT INTO CIS2.TABLE_OUT 
--(
--  PERIOADA,
--  FORM,
--  FORM_VERS,
--  ID_MDTABLE,
--  COD_CUATM,
--  NR_SECTIE,
--  NUME_SECTIE,
--  NR_SECTIE1,
--  NUME_SECTIE1,
--  NR_SECTIE2,
--  NUME_SECTIE2,
--  NR_ROW,
--  ORDINE,
--  DECIMAL_POS,
--  NUME_ROW,  
--  COL1,COL2, COL3, COL4, COL5, COL6, COL7, COL8, COL9, COL10
--)
--
SELECT
  :PPERIOADA AS PERIOADA,
  :PFORM AS FORM,
  :PFORM_VERS AS FORM_VERS,
  :PID_MDTABLE AS ID_MDTABLE,
  :PCOD_CUATM AS COD_CUATM,
         
  '0' AS NR_SECTIE,
  '0' AS NUME_SECTIE,
  '0' AS NR_SECTIE1,
  '0' AS NUME_SECTIE1,
  '0' AS NR_SECTIE2,
  '0' AS NUME_SECTIE2,
  NR_ROW AS NR_ROW,
  ROWNUM AS ORDINE,
  '0000000000' AS DECIMAL_POS,
  NUME_ROW AS NUME_ROW,
  COL1,COL2, COL3, COL4, COL5, COL6, COL7, COL8, COL9, COL10
FROM
(
SELECT 
--  CTM.NR_ROW    AS NR_SECTIE,
--  CTM.NUME_ROW AS NUME_SECTIE,
  TO_NUMBER(ED.CODUL) AS NR_ROW, 
  ED.FULL_CODE AS ORDINE,
  ED.DENUMIRE AS NUME_ROW, 
   
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '1%' AND ID_MD NOT IN (36835,36836,36837, 36986,36987,36988,36989,36990)THEN D.COL8 END)) + 
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '1%' AND ID_MD NOT IN (36835,36836,36837, 36986,36987,36988,36989,36990) THEN D.COL10 END)) + 
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '2%' AND ID_MD NOT IN (36991,36992,36993, 36994) THEN D.COL12 END)) + 
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '3%' AND ID_MD NOT IN (36995,36996,36997,36998,36999) THEN D.COL12 END)) AS COL1,
  
  
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '1%' AND ID_MD NOT IN (36835,36836,36837, 36986,36987,36988,36989,36990)THEN D.COL8 END)) AS COL2, 
 
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '1%' AND ID_MD NOT IN (36835,36836,36837, 36986,36987,36988,36989,36990) THEN D.COL10 END)) AS COL3, 
 
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '2%' AND ID_MD NOT IN (36991,36992,36993, 36994) THEN D.COL12 END)) AS COL4,  -- COL4
  
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '3%' AND ID_MD NOT IN (36995,36996,36997,36998,36999) THEN D.COL12 END)) AS COL5,
 
---- 
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '1%' AND ID_MD NOT IN (36835,36836,36837, 36986,36987,36988,36989,36990) THEN D.COL9 END))+
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '1%' AND ID_MD NOT IN (36835,36836,36837, 36986,36987,36988,36989,36990) THEN D.COL11 END)) +
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '2%' AND ID_MD NOT IN (36991,36992,36993, 36994) THEN D.COL14 END)) +
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '3%' AND ID_MD NOT IN (36995,36996,36997,36998,36999) THEN D.COL14 END)) AS COL6,
  
 
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '1%' AND ID_MD NOT IN (36835,36836,36837, 36986,36987,36988,36989,36990) THEN D.COL9 END)) AS COL7,
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '1%' AND ID_MD NOT IN (36835,36836,36837, 36986,36987,36988,36989,36990) THEN D.COL11 END)) AS COL8,
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '2%' AND ID_MD NOT IN (36991,36992,36993, 36994) THEN D.COL14 END)) AS COL9,
 CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN 1058 AND D.RIND LIKE '3%' AND ID_MD NOT IN (36995,36996,36997,36998,36999) THEN D.COL14 END)) AS COL10
--  

FROM 

   CIS2.VW_CL_SPEC_3EDU ED
  LEFT  JOIN CIS2.VW_CL_SPEC_3EDU EDD ON (EDD.FULL_CODE LIKE  '%'||ED.CODUL||';%')
  LEFT  JOIN 
  (
    SELECT D.* FROM CIS2.VW_DATA_ALL D
    WHERE D.PERIOADA IN (:PPERIOADA)
      AND D.CUATM_FULL LIKE '%'||:PCOD_CUATM||';%'
      AND D.FORM       IN(50)
      AND D.CAPITOL    IN(1058)    
  ) D ON (TO_CHAR(SUBSTR(D.RIND,2,10),'0000000')= EDD.CODUL) 
  INNER JOIN CIS2.RENIM R ON (D.CUIIO=R.CUIIO AND D.CUIIO_VERS=R.CUIIO_VERS)
  INNER JOIN CIS2.VW_CL_CUATM CC ON(D.CUATM = CC.CODUL)

  
  
  WHERE
  
  PERIOADA IN (:PPERIOADA) AND 
  D.FORM_VERS = :PFORM_VERS     AND  
  D.FORM = :PFORM   AND    
  (:PID_MDTABLE=:PID_MDTABLE) AND
  D.CUATM_FULL LIKE '%'||:PCOD_CUATM||';%' AND
  D.FORM IN (50) 
  
 GROUP BY 
   ED.CODUL,
   ED.FULL_CODE,
   ED.DENUMIRE
   
 ORDER BY  
   ED.FULL_CODE
  )