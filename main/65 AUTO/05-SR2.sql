SELECT
  'Numarul de rinduri introduse: '||SUM(CASE WHEN D.CAPITOL NOT IN (2) AND D.CAPITOL IS NOT NULL THEN 1 ELSE 0 END)
  AS REZULTAT,
  
  SUM(CASE WHEN D.CAPITOL NOT IN (2) AND D.CAPITOL IS NOT NULL THEN NVAL(D.COL1)+NVAL(D.COL2) ELSE 0 END) AS COL2

FROM
  VW_DATA_ALL D

WHERE
  (D.PERIOADA=:PERIOADA          ) AND
  (D.CUIIO=:CUIIO                ) AND
  (D.CUIIO_VERS=:CUIIO_VERS     OR :CUIIO_VERS = -1) AND
  (D.FORM = :FORM               ) AND
  (D.FORM_VERS=:FORM_VERS ) AND
  (:CAPITOL=:CAPITOL) AND
  (:CAPITOL_VERS=:CAPITOL_VERS) AND
  (:ID_MD=:ID_MD)
  
  AND D.FORM NOT IN(1,2)
  

  
  
HAVING
  (SUM(CASE WHEN  D.CAPITOL=2 AND D.RIND IN('00','01','02','03','04','05','06','07','10','11','12') AND NVAL(D.COL1)=1 THEN 1 ELSE 0 END)>0) 
  AND
  (
   (NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND||'.'||D.COL1='2.01.1' THEN 1 ELSE 0 END))>0 AND NVAL(SUM(CASE WHEN D.CAPITOL NOT IN (2) AND D.CAPITOL IS NOT NULL THEN 1 ELSE 0 END))=0) 
   
   
   OR
   (NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND||'.'||D.COL1='2.01.1' THEN 1 ELSE 0 END))=0 AND NVAL(SUM(CASE WHEN D.CAPITOL NOT IN (2) AND D.CAPITOL IS NOT NULL THEN 1 ELSE 0 END))>0)
  )
  
  AND SUM(CASE WHEN D.CAPITOL NOT IN (2) AND D.CAPITOL IS NOT NULL THEN NVAL(D.COL1)+NVAL(D.COL2) ELSE 0 END) >  0 