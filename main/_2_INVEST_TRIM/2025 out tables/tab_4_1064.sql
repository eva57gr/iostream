DECLARE -- ====================================================================

  CURSOR C IS
  SELECT
    :pCOD_CUATM AS pCOD_CUATM
  FROM
    DUAL;

BEGIN -- ======================================================================
  FOR CR IN C
  LOOP
   IF CR.pCOD_CUATM = '0000000' THEN
    INSERT INTO TABLE_OUT 
(
  PERIOADA,
  FORM,
  FORM_VERS,
  ID_MDTABLE,
  COD_CUATM,
  NR_SECTIE,
  NUME_SECTIE,
  NR_SECTIE1,
  NUME_SECTIE1,
  NR_SECTIE2,
  NUME_SECTIE2,
  NR_ROW,
  ORDINE,
  DECIMAL_POS,
  NUME_ROW,  
 COL1,COL2,COL3,COL4
)

SELECT 
  :pPERIOADA AS PERIOADA,
  :pFORM AS FORM,
  :pFORM_VERS AS FORM_VERS,
  :pID_MDTABLE AS ID_MDTABLE,
  :pCOD_CUATM AS COD_CUATM,    
  '0' AS NR_SECTIE,
  '0' AS NUME_SECTIE,
  '0' AS NR_SECTIE1,
  '0' AS NUME_SECTIE1,
  '0' AS NR_SECTIE2,
  '0' AS NUME_SECTIE2,
   ORDINE AS NR_ROW,
   ORDINE AS ORDINE,
  '0000' AS DECIMAL_POS,
   DENUMIRE AS NUME_ROW,
   COL1, COL2, COL3, COL4
   
FROM (
------------------------
SELECT
  'Cladiri rezidentiale/case de locuit individuale, unitati' AS DENUMIRE,
  1 AS ORDINE,
  CIS.NVAL(SUM(CASE WHEN  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32)  AND D.RIND IN '0000000'AND D.CAPITOL IN (32)   THEN D.COL1 ELSE 0 END)) AS COL1,
  CIS.NVAL(SUM(CASE WHEN  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32)  AND CC.PRGS IN (3,5)   THEN D.COL1 ELSE 0 END)) AS COL2,
  CIS.NVAL(SUM(CASE WHEN  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND CC.PRGS IN (6,8,9) THEN D.COL1 ELSE 0 END)) AS COL3,  
  
  ROUND(CIS.NVAL(SUM(CASE WHEN   (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND D.RIND IN '0000000' THEN D.COL1 ELSE 0 END))  /
  CIS.NOZERO(SUM(CASE WHEN   (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND  D.CAPITOL IN (32) AND D.RIND IN ('0000000') THEN D.COL1 ELSE 0 END))*100,1) AS COL4   
   
  
FROM 
  CIS.VW_DATA_ALL D
 INNER JOIN CIS.MD_RIND R ON R.ID_MD = D.ID_MD 
 INNER JOIN VW_CL_CUATM  CC ON (CC.CODUL = D.RIND) 


WHERE
  ----------------------------------------------------------------------------
  ((D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) 
  OR 
  (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4))
  
  ) AND 
  ----------------------------------------------------------------------------

  (:pFORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  D.FORM IN (6) AND
  D.FORM_VERS = :pFORM_VERS AND    
  D.CAPITOL IN (32) AND
 (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%')

 
UNION

SELECT
  C.DENUMIRE,
  C.ORDINE,
 
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  D.CAPITOL IN (32) AND (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND D.RIND IN '0000000'AND D.CAPITOL IN (32)   THEN D.COL1 ELSE 0 END)) AS COL1,
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  D.CAPITOL IN (32) AND (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND CC.PRGS IN (3,5)   THEN D.COL1 ELSE 0 END)) AS COL2,
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  D.CAPITOL IN (32) AND  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND CC.PRGS IN (6,8,9) THEN D.COL1 ELSE 0 END)) AS COL3,  
  
  ROUND(CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32)  AND D.RIND IN '0000000' THEN D.COL1 ELSE 0 END))  /
  CIS.NOZERO(SUM(CASE WHEN  C.CFP LIKE '%'|| D.CFP ||'%' AND (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND  D.CAPITOL IN (32)  AND D.RIND IN ('0000000') THEN D.COL1 ELSE 0 END))*100,1) AS COL4  
   
FROM
  CIS.VW_DATA_ALL D
   INNER JOIN CIS.MD_RIND R ON R.ID_MD = D.ID_MD 
 INNER JOIN VW_CL_CUATM  CC ON (CC.CODUL = D.RIND) 
  CROSS JOIN
  (
SELECT 2 AS ORDINE, '12+13' AS CFP, 'publica' AS DENUMIRE FROM DUAL UNION
SELECT 3 AS ORDINE, '15+16+18+19' AS CFP, 'privata - total' AS DENUMIRE FROM DUAL UNION
SELECT 4 AS ORDINE, '15' AS CFP, 'privata' AS DENUMIRE FROM DUAL UNION
SELECT 5 AS ORDINE, '16' AS CFP, 'colectiva' AS DENUMIRE FROM DUAL UNION
SELECT 6 AS ORDINE, '18' AS CFP, 'proprietatea organizatiilor obstesti' AS DENUMIRE FROM DUAL UNION
SELECT 7 AS ORDINE, '20' AS CFP, 'mixta (publica si privata), fara participare straina' AS DENUMIRE FROM DUAL UNION
SELECT 8 AS ORDINE, '24+26' AS CFP, 'straina' AS DENUMIRE FROM DUAL UNION
SELECT 9 AS ORDINE, '28' AS CFP, 'a intreprinderilor mixte' AS DENUMIRE FROM DUAL
) C
  
WHERE
   ----------------------------------------------------------------------------
  ((D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) 
  OR 
  (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4))
  
  ) AND 
  ----------------------------------------------------------------------------

  (:pFORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  D.FORM IN (6) AND
  D.FORM_VERS = :pFORM_VERS AND    
  D.CAPITOL IN (32) AND
 (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%')
  
GROUP BY
  C.DENUMIRE,
  C.ORDINE
  
  UNION
--------------------------------COL2
SELECT
  'Locuinte (apartamente), unitati' AS DENUMIRE,
  10 AS ORDINE,
  CIS.NVAL(SUM(CASE WHEN  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32)  AND D.RIND IN '0000000'AND D.CAPITOL IN (32)   THEN D.COL2 ELSE 0 END)) AS COL1,
  CIS.NVAL(SUM(CASE WHEN  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32)  AND CC.PRGS IN (3,5)   THEN D.COL2 ELSE 0 END)) AS COL2,
  CIS.NVAL(SUM(CASE WHEN  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND CC.PRGS IN (6,8,9) THEN D.COL2 ELSE 0 END)) AS COL3,  
  
  ROUND(CIS.NVAL(SUM(CASE WHEN   (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND D.RIND IN '0000000' THEN D.COL2 ELSE 0 END))  /
  CIS.NOZERO(SUM(CASE WHEN   (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND  D.CAPITOL IN (32) AND D.RIND IN ('0000000') THEN D.COL2 ELSE 0 END))*100,1) AS COL4   
   
  
FROM 
  CIS.VW_DATA_ALL D
 INNER JOIN CIS.MD_RIND R ON R.ID_MD = D.ID_MD 
 INNER JOIN VW_CL_CUATM  CC ON (CC.CODUL = D.RIND) 


WHERE
  ----------------------------------------------------------------------------
  ((D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) 
  OR 
  (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4))
  
  ) AND 
  ----------------------------------------------------------------------------

  (:pFORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  D.FORM IN (6) AND
  D.FORM_VERS = :pFORM_VERS AND    
  D.CAPITOL IN (32) AND
 (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%')

 
UNION

SELECT
  C.DENUMIRE,
  C.ORDINE,
 
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  D.CAPITOL IN (32) AND (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND D.RIND IN '0000000'AND D.CAPITOL IN (32)   THEN D.COL2 ELSE 0 END)) AS COL1,
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  D.CAPITOL IN (32) AND (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND CC.PRGS IN (3,5)   THEN D.COL2 ELSE 0 END)) AS COL2,
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  D.CAPITOL IN (32) AND  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND CC.PRGS IN (6,8,9) THEN D.COL2 ELSE 0 END)) AS COL3,  
  
  ROUND(CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32)  AND D.RIND IN '0000000' THEN D.COL2 ELSE 0 END))  /
  CIS.NOZERO(SUM(CASE WHEN  C.CFP LIKE '%'|| D.CFP ||'%' AND (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND  D.CAPITOL IN (32)  AND D.RIND IN ('0000000') THEN D.COL2 ELSE 0 END))*100,1) AS COL4  
   
FROM
  CIS.VW_DATA_ALL D
   INNER JOIN CIS.MD_RIND R ON R.ID_MD = D.ID_MD 
 INNER JOIN VW_CL_CUATM  CC ON (CC.CODUL = D.RIND) 
  CROSS JOIN
  (
SELECT 11 AS ORDINE, '12+13' AS CFP, 'publica' AS DENUMIRE FROM DUAL UNION
SELECT 12 AS ORDINE, '15+16+18+19' AS CFP, 'privata - total' AS DENUMIRE FROM DUAL UNION
SELECT 13 AS ORDINE, '15' AS CFP, 'privata' AS DENUMIRE FROM DUAL UNION
SELECT 14 AS ORDINE, '16' AS CFP, 'colectiva' AS DENUMIRE FROM DUAL UNION
SELECT 15 AS ORDINE, '18' AS CFP, 'proprietatea organizatiilor obstesti' AS DENUMIRE FROM DUAL UNION
SELECT 16 AS ORDINE, '20' AS CFP, 'mixta (publica si privata), fara participare straina' AS DENUMIRE FROM DUAL UNION
SELECT 17 AS ORDINE, '24+26' AS CFP, 'straina' AS DENUMIRE FROM DUAL UNION
SELECT 18 AS ORDINE, '28' AS CFP, 'a intreprinderilor mixte' AS DENUMIRE FROM DUAL

) C
  
WHERE
   ----------------------------------------------------------------------------
  ((D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) 
  OR 
  (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4))
  
  ) AND 
  ----------------------------------------------------------------------------

  (:pFORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  D.FORM IN (6) AND
  D.FORM_VERS = :pFORM_VERS AND    
  D.CAPITOL IN (32) AND
 (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%')
  
GROUP BY
  C.DENUMIRE,
  C.ORDINE
------------------------------COL3
  UNION
 SELECT
  'Suprafata totala a locuintelor (apartamentelor), m.p' AS DENUMIRE,
  19 AS ORDINE,
  CIS.NVAL(SUM(CASE WHEN  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32)  AND D.RIND IN '0000000'AND D.CAPITOL IN (32)   THEN D.COL3 ELSE 0 END)) AS COL1,
  CIS.NVAL(SUM(CASE WHEN  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32)  AND CC.PRGS IN (3,5)   THEN D.COL3 ELSE 0 END)) AS COL2,
  CIS.NVAL(SUM(CASE WHEN  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND CC.PRGS IN (6,8,9) THEN D.COL3 ELSE 0 END)) AS COL3,  
  
  ROUND(CIS.NVAL(SUM(CASE WHEN   (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND D.RIND IN '0000000' THEN D.COL3 ELSE 0 END))  /
  CIS.NOZERO(SUM(CASE WHEN   (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND  D.CAPITOL IN (32) AND D.RIND IN ('0000000') THEN D.COL3 ELSE 0 END))*100,1) AS COL4   
   
  
FROM 
  CIS.VW_DATA_ALL D
 INNER JOIN CIS.MD_RIND R ON R.ID_MD = D.ID_MD 
 INNER JOIN VW_CL_CUATM  CC ON (CC.CODUL = D.RIND) 


WHERE
  ----------------------------------------------------------------------------
  ((D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) 
  OR 
  (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4))
  
  ) AND 
  ----------------------------------------------------------------------------

  (:pFORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  D.FORM IN (6) AND
  D.FORM_VERS = :pFORM_VERS AND    
  D.CAPITOL IN (32) AND
 (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%')

 
UNION

SELECT
  C.DENUMIRE,
  C.ORDINE,
 
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  D.CAPITOL IN (32) AND (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND D.RIND IN '0000000'AND D.CAPITOL IN (32)   THEN D.COL3 ELSE 0 END)) AS COL1,
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  D.CAPITOL IN (32) AND (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND CC.PRGS IN (3,5)   THEN D.COL3 ELSE 0 END)) AS COL2,
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  D.CAPITOL IN (32) AND  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND CC.PRGS IN (6,8,9) THEN D.COL3 ELSE 0 END)) AS COL3,  
  
  ROUND(CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32)  AND D.RIND IN '0000000' THEN D.COL3 ELSE 0 END))  /
  CIS.NOZERO(SUM(CASE WHEN  C.CFP LIKE '%'|| D.CFP ||'%' AND (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND  D.CAPITOL IN (32)  AND D.RIND IN ('0000000') THEN D.COL3 ELSE 0 END))*100,1) AS COL4  
   
FROM
  CIS.VW_DATA_ALL D
   INNER JOIN CIS.MD_RIND R ON R.ID_MD = D.ID_MD 
 INNER JOIN VW_CL_CUATM  CC ON (CC.CODUL = D.RIND) 
  CROSS JOIN
  (
SELECT 20 AS ORDINE, '12+13' AS CFP, 'publica' AS DENUMIRE FROM DUAL UNION
SELECT 21 AS ORDINE, '15+16+18+19' AS CFP, 'privata - total' AS DENUMIRE FROM DUAL UNION
SELECT 22 AS ORDINE, '15' AS CFP, 'privata' AS DENUMIRE FROM DUAL UNION
SELECT 23 AS ORDINE, '16' AS CFP, 'colectiva' AS DENUMIRE FROM DUAL UNION
SELECT 24 AS ORDINE, '18' AS CFP, 'proprietatea organizatiilor obstesti' AS DENUMIRE FROM DUAL UNION
SELECT 25 AS ORDINE, '20' AS CFP, 'mixta (publica si privata), fara participare straina' AS DENUMIRE FROM DUAL UNION
SELECT 26 AS ORDINE, '24+26' AS CFP, 'straina' AS DENUMIRE FROM DUAL UNION
SELECT 27 AS ORDINE, '28' AS CFP, 'a intreprinderilor mixte' AS DENUMIRE FROM DUAL

) C
  
WHERE
   ----------------------------------------------------------------------------
  ((D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) 
  OR 
  (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4))
  
  ) AND 
  ----------------------------------------------------------------------------

  (:pFORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  D.FORM IN (6) AND
  D.FORM_VERS = :pFORM_VERS AND    
  D.CAPITOL IN (32) AND
 (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%')
  
GROUP BY
  C.DENUMIRE,
  C.ORDINE
  
);
   ELSE
     INSERT INTO TABLE_OUT 
(
  PERIOADA,
  FORM,
  FORM_VERS,
  ID_MDTABLE,
  COD_CUATM,
  NR_SECTIE,
  NUME_SECTIE,
  NR_SECTIE1,
  NUME_SECTIE1,
  NR_SECTIE2,
  NUME_SECTIE2,
  NR_ROW,
  ORDINE,
  DECIMAL_POS,
  NUME_ROW,  
 COL1,COL2,COL3,COL4
)



SELECT 
  :pPERIOADA AS PERIOADA,
  :pFORM AS FORM,
  :pFORM_VERS AS FORM_VERS,
  :pID_MDTABLE AS ID_MDTABLE,
  :pCOD_CUATM AS COD_CUATM,    
  '0' AS NR_SECTIE,
  '0' AS NUME_SECTIE,
  '0' AS NR_SECTIE1,
  '0' AS NUME_SECTIE1,
  '0' AS NR_SECTIE2,
  '0' AS NUME_SECTIE2,
   ORDINE AS NR_ROW,
   ORDINE AS ORDINE,
  '0000' AS DECIMAL_POS,
   DENUMIRE AS NUME_ROW,
   COL1, COL2, COL3, COL4
   
FROM (
------------------------
SELECT
  'Cladiri rezidentiale/case de locuit individuale, unitati' AS DENUMIRE,
  1 AS ORDINE,
  CIS.NVAL(SUM(CASE WHEN  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32)  AND D.RIND NOT IN '0000000'AND D.CAPITOL IN (32)   THEN D.COL1 ELSE 0 END)) AS COL1,
  CIS.NVAL(SUM(CASE WHEN  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32)  AND CC.PRGS IN (3,5)   THEN D.COL1 ELSE 0 END)) AS COL2,
  CIS.NVAL(SUM(CASE WHEN  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND CC.PRGS IN (6,8,9) THEN D.COL1 ELSE 0 END)) AS COL3,  
  
  ROUND(CIS.NVAL(SUM(CASE WHEN   (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND D.RIND NOT IN '0000000' THEN D.COL1 ELSE 0 END))  /
  CIS.NOZERO(SUM(CASE WHEN   (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND  D.CAPITOL IN (32) AND D.RIND NOT IN ('0000000') THEN D.COL1 ELSE 0 END))*100,1) AS COL4   
   
  
FROM 
  CIS.VW_DATA_ALL D
 INNER JOIN CIS.VW_CL_CUATM CC ON (D.RIND=CC.CODUL ) 
 INNER JOIN CIS.VW_CL_CUATM CF ON ((CC.CODUL=CF.CODUL and CC.FULL_CODE LIKE '%'||CF.CODUL||'%'))


WHERE
  ----------------------------------------------------------------------------
  ((D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) 
  OR 
  (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4))
  
  ) AND 
  ----------------------------------------------------------------------------

  (:pFORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  D.FORM IN (6) AND
  D.FORM_VERS = :pFORM_VERS AND    
  D.CAPITOL IN (32) AND  CC.FULL_CODE LIKE '%'||:pCOD_CUATM||'%' AND CC.PRGS NOT IN 4 
-- (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%')

 
UNION

SELECT
  C.DENUMIRE,
  C.ORDINE,
 
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  D.CAPITOL IN (32) AND (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND D.RIND NOT IN '0000000'AND D.CAPITOL IN (32)   THEN D.COL1 ELSE 0 END)) AS COL1,
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  D.CAPITOL IN (32) AND (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND CC.PRGS IN (3,5)   THEN D.COL1 ELSE 0 END)) AS COL2,
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  D.CAPITOL IN (32) AND  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND CC.PRGS IN (6,8,9) THEN D.COL1 ELSE 0 END)) AS COL3,  
  
  ROUND(CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32)  AND D.RIND NOT IN '0000000' THEN D.COL1 ELSE 0 END))  /
  CIS.NOZERO(SUM(CASE WHEN  C.CFP LIKE '%'|| D.CFP ||'%' AND (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND  D.CAPITOL IN (32)  AND D.RIND NOT IN ('0000000') THEN D.COL1 ELSE 0 END))*100,1) AS COL4  
   
FROM
  CIS.VW_DATA_ALL D
  
 INNER JOIN CIS.VW_CL_CUATM CC ON (D.RIND=CC.CODUL ) 
 INNER JOIN CIS.VW_CL_CUATM CF ON ((CC.CODUL=CF.CODUL and CC.FULL_CODE LIKE '%'||CF.CODUL||'%')) 
  CROSS JOIN
  (
SELECT 2 AS ORDINE, '12+13' AS CFP, 'publica' AS DENUMIRE FROM DUAL UNION
SELECT 3 AS ORDINE, '15+16+18+19' AS CFP, 'privata - total' AS DENUMIRE FROM DUAL UNION
SELECT 4 AS ORDINE, '15' AS CFP, 'privata' AS DENUMIRE FROM DUAL UNION
SELECT 5 AS ORDINE, '16' AS CFP, 'colectiva' AS DENUMIRE FROM DUAL UNION
SELECT 6 AS ORDINE, '18' AS CFP, 'proprietatea organizatiilor obstesti' AS DENUMIRE FROM DUAL UNION
SELECT 7 AS ORDINE, '20' AS CFP, 'mixta (publica si privata), fara participare straina' AS DENUMIRE FROM DUAL UNION
SELECT 8 AS ORDINE, '24+26' AS CFP, 'straina' AS DENUMIRE FROM DUAL UNION
SELECT 9 AS ORDINE, '28' AS CFP, 'a intreprinderilor mixte' AS DENUMIRE FROM DUAL
) C
  
WHERE
   ----------------------------------------------------------------------------
  ((D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) 
  OR 
  (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4))
  
  ) AND 
  ----------------------------------------------------------------------------

  (:pFORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  D.FORM IN (6) AND
  D.FORM_VERS = :pFORM_VERS AND    
  D.CAPITOL IN (32) AND  CC.FULL_CODE LIKE '%'||:pCOD_CUATM||'%' AND CC.PRGS NOT IN 4 
-- (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%')
  
GROUP BY
  C.DENUMIRE,
  C.ORDINE
  
  UNION
--------------------------------COL2
SELECT
  'Locuinte (apartamente), unitati' AS DENUMIRE,
  10 AS ORDINE,
  CIS.NVAL(SUM(CASE WHEN (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND D.RIND NOT IN '0000000' AND D.CAPITOL IN (32)   THEN D.COL2 ELSE 0 END)) AS COL1,
  CIS.NVAL(SUM(CASE WHEN (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND CC.PRGS IN (3,5) AND D.RIND NOT IN ('910')   THEN D.COL2 ELSE 0 END)) AS COL2,
  CIS.NVAL(SUM(CASE WHEN (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND CC.PRGS IN (6,8,9) AND D.RIND NOT IN ('910') THEN D.COL2 ELSE 0 END)) AS COL3, 
  ROUND(CIS.NVAL(SUM(CASE WHEN (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND D.RIND NOT IN '0000000' THEN D.COL2 ELSE 0 END)) / 
  NOZERO(CIS.NVAL(SUM(CASE WHEN (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND D.CAPITOL IN (32) AND D.RIND NOT IN '0000000' THEN D.COL2 ELSE 0 END))) *100,1 )AS COL4
FROM  
 CIS.VW_DATA_ALL D 
   
 INNER JOIN CIS.VW_CL_CUATM CC ON (D.RIND=CC.CODUL) 
 INNER JOIN CIS.VW_CL_CUATM CF ON ((CC.CODUL=CF.CODUL and CC.FULL_CODE LIKE '%'||CF.CODUL||'%'))
--(CC.CODUL = D.RIND OR D.RIND IN ('910')) 
WHERE
    ----------------------------------------------------------------------------
  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA OR
  D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND
   ----------------------------------------------------------------------------
  (:pFORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  D.FORM IN (6) AND
  D.FORM_VERS = :pFORM_VERS AND    
  D.CAPITOL IN (32) AND  CC.FULL_CODE LIKE '%'||:pCOD_CUATM||'%'
-- (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%')
 
 UNION
 
SELECT
  C.DENUMIRE,
  C.ORDINE,
 
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND D.RIND NOT IN '0000000'AND D.CAPITOL IN (32)   THEN D.COL2 ELSE 0 END)) AS COL1,
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND(D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND CC.PRGS IN (3,5)   THEN D.COL2 ELSE 0 END)) AS COL2,
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND(D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND CC.PRGS IN (6,8,9) THEN D.COL2 ELSE 0 END)) AS COL3,    
  ROUND(CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND D.RIND NOT IN '0000000' THEN D.COL2 ELSE 0 END)) / 
  NOZERO(CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND D.CAPITOL IN (32) AND D.RIND NOT IN '0000000' THEN D.COL2 ELSE 0 END))) *100,1 )AS COL4  
        
FROM  
 CIS.VW_DATA_ALL D
  
 INNER JOIN CIS.VW_CL_CUATM CC ON (D.RIND=CC.CODUL) 
 INNER JOIN CIS.VW_CL_CUATM CF ON ((CC.CODUL=CF.CODUL and CC.FULL_CODE LIKE '%'||CF.CODUL||'%'))
   CROSS JOIN
  (
SELECT 11 AS ORDINE, '12+13' AS CFP, 'publica' AS DENUMIRE FROM DUAL UNION
SELECT 12 AS ORDINE, '15+16+18+19' AS CFP, 'privata - total' AS DENUMIRE FROM DUAL UNION
SELECT 13 AS ORDINE, '15' AS CFP, 'privata' AS DENUMIRE FROM DUAL UNION
SELECT 14 AS ORDINE, '16' AS CFP, 'colectiva' AS DENUMIRE FROM DUAL UNION
SELECT 15 AS ORDINE, '18' AS CFP, 'proprietatea organizatiilor obstesti' AS DENUMIRE FROM DUAL UNION
SELECT 16 AS ORDINE, '20' AS CFP, 'mixta (publica si privata), fara participare straina' AS DENUMIRE FROM DUAL UNION
SELECT 17 AS ORDINE, '24+26' AS CFP, 'straina' AS DENUMIRE FROM DUAL UNION
SELECT 18 AS ORDINE, '28' AS CFP, 'a intreprinderilor mixte' AS DENUMIRE FROM DUAL
) C 
WHERE
    ----------------------------------------------------------------------------
  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA OR
  D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND
   ----------------------------------------------------------------------------

  (:pFORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  D.FORM IN (6) AND
  D.FORM_VERS = :pFORM_VERS AND    
  D.CAPITOL IN (32) AND  CC.FULL_CODE LIKE '%'||:pCOD_CUATM||'%' AND CC.PRGS NOT IN 4 
-- (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%')
 
   
GROUP BY
  C.DENUMIRE,
  C.ORDINE
------------------------------COL3
  UNION
  SELECT
 'Suprafata totala a locuintelor (apartamentelor), m.p' AS DENUMIRE,
  19 AS ORDINE,
  CIS.NVAL(SUM(CASE WHEN (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND D.RIND NOT IN '0000000'AND D.CAPITOL IN (32)   THEN D.COL3 ELSE 0 END)) AS COL1,
  CIS.NVAL(SUM(CASE WHEN (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND CC.PRGS IN (3,5)   THEN D.COL3 ELSE 0 END)) AS COL2,
  CIS.NVAL(SUM(CASE WHEN (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND CC.PRGS IN (6,8,9) THEN D.COL3 ELSE 0 END)) AS COL3,    
  ROUND(CIS.NVAL(SUM(CASE WHEN (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND D.RIND NOT IN '0000000' THEN D.COL3 ELSE 0 END)) / 
  NOZERO(CIS.NVAL(SUM(CASE WHEN (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND D.CAPITOL IN (32) AND D.RIND NOT IN '0000000' THEN D.COL3 ELSE 0 END))) *100,1 )AS COL4  
        
FROM  
 CIS.VW_DATA_ALL D
  
 INNER JOIN CIS.VW_CL_CUATM CC ON (D.RIND=CC.CODUL) 
 INNER JOIN CIS.VW_CL_CUATM CF ON ((CC.CODUL=CF.CODUL and CC.FULL_CODE LIKE '%'||CF.CODUL||'%')) 
 
 
WHERE
    ----------------------------------------------------------------------------
  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA OR
  D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND
   ----------------------------------------------------------------------------

  (:pFORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  D.FORM IN (6) AND
  D.FORM_VERS = :pFORM_VERS AND    
  D.CAPITOL IN (32) AND  CC.FULL_CODE LIKE '%'||:pCOD_CUATM||'%' AND CC.PRGS NOT IN 4 
-- (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%')
 
 UNION
 
SELECT
  C.DENUMIRE,
  C.ORDINE,
 
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND D.RIND NOT IN '0000000'AND D.CAPITOL IN (32)   THEN D.COL3 ELSE 0 END)) AS COL1,
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND(D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND CC.PRGS IN (3,5)   THEN D.COL3 ELSE 0 END)) AS COL2,
  CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND(D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND CC.PRGS IN (6,8,9) THEN D.COL3 ELSE 0 END)) AS COL3,    
  ROUND(CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA) AND  D.CAPITOL IN (32) AND D.RIND NOT IN '0000000' THEN D.COL3 ELSE 0 END)) / 
  NOZERO(CIS.NVAL(SUM(CASE WHEN C.CFP LIKE '%'|| D.CFP ||'%' AND (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND D.CAPITOL IN (32) AND D.RIND NOT IN '0000000' THEN D.COL3 ELSE 0 END))) *100,1 )AS COL4  
        
FROM  
 CIS.VW_DATA_ALL D
  
 INNER JOIN CIS.VW_CL_CUATM CC ON (D.RIND=CC.CODUL)-- OR D.RIND NOT IN ('0000000')) 
 INNER JOIN CIS.VW_CL_CUATM CF ON ((CC.CODUL=CF.CODUL and CC.FULL_CODE LIKE '%'||CF.CODUL||'%')) 
   CROSS JOIN
  (
SELECT 20 AS ORDINE, '12+13' AS CFP, 'publica' AS DENUMIRE FROM DUAL UNION
SELECT 21 AS ORDINE, '15+16+18+19' AS CFP, 'privata - total' AS DENUMIRE FROM DUAL UNION
SELECT 22 AS ORDINE, '15' AS CFP, 'privata' AS DENUMIRE FROM DUAL UNION
SELECT 23 AS ORDINE, '16' AS CFP, 'colectiva' AS DENUMIRE FROM DUAL UNION
SELECT 24 AS ORDINE, '18' AS CFP, 'proprietatea organizatiilor obstesti' AS DENUMIRE FROM DUAL UNION
SELECT 25 AS ORDINE, '20' AS CFP, 'mixta (publica si privata), fara participare straina' AS DENUMIRE FROM DUAL UNION
SELECT 26 AS ORDINE, '24+26' AS CFP, 'straina' AS DENUMIRE FROM DUAL UNION
SELECT 27 AS ORDINE, '28' AS CFP, 'a intreprinderilor mixte' AS DENUMIRE FROM DUAL
) C 

WHERE
    ----------------------------------------------------------------------------
  (D.PERIOADA BETWEEN FLOOR(:pPERIOADA/4)*4 AND :pPERIOADA OR
  D.PERIOADA BETWEEN FLOOR((:pPERIOADA-4)/4)*4 AND (:pPERIOADA-4)) AND
   ----------------------------------------------------------------------------

  (:pFORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  D.FORM IN (6) AND
  D.FORM_VERS = :pFORM_VERS AND    
  D.CAPITOL IN (32) AND
  CC.FULL_CODE LIKE '%'||:pCOD_CUATM||'%' AND CC.PRGS NOT IN 4 
-- (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%')
 
   
GROUP BY
  C.DENUMIRE,
  C.ORDINE
  
      
);
   END IF;
  END LOOP;
END; -- =======================================================================