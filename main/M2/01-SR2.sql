SELECT
  'Numarul de rinduri introduse: '||SUM(CASE WHEN D.CAPITOL<>'0'AND D.CAPITOL||'.'||D.RIND NOT IN ('7.20','16.20','22.20') THEN 1 ELSE 0 END)
  AS REZULTAT

FROM
  VW_DATA_ALL D

WHERE
  (D.PERIOADA=:PERIOADA         OR :PERIOADA = -1) AND
  (D.CUIIO=:CUIIO               OR :CUIIO = -1) AND
  (D.CUIIO_VERS=:CUIIO_VERS     OR :CUIIO_VERS = -1) AND
  (D.FORM = :FORM               OR :FORM = -1) AND
  (D.FORM_VERS=:FORM_VERS       OR :FORM_VERS = -1) AND
  (:CAPITOL=:CAPITOL) AND
  (:CAPITOL_VERS=:CAPITOL_VERS) AND
  (:ID_MD=:ID_MD)
  
  AND D.FORM NOT IN (2,3,4,5,6,8,90,1,11)
  
HAVING
  (SUM(CASE WHEN  D.CAPITOL=0 AND D.RIND IN('01','02','03','04','05','06','07') AND D.COL1=1 THEN 1 ELSE 0 END)>0) AND
  (
   (NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND||'.'||D.COL1='0.01.1' THEN 1 ELSE 0 END))>0 AND NVAL(SUM(CASE WHEN D.CAPITOL<>'0'AND D.CAPITOL||'.'||D.RIND NOT IN ('7.20','16.20','22.20')  THEN 1 ELSE 0 END))=0) OR
   (NVAL(SUM(CASE WHEN D.CAPITOL||'.'||D.RIND||'.'||D.COL1='0.01.1' THEN 1 ELSE 0 END))=0 AND NVAL(SUM(CASE WHEN D.CAPITOL<>'0'AND D.CAPITOL||'.'||D.RIND NOT IN ('7.20','16.20','22.20')  THEN 1 ELSE 0 END))>0)
  )
  